!function(l){function y(e,t){var o;return 2===arguments.length&&(window.Upscope._config[e]=t),1===arguments.length?"function"==typeof(o=window.Upscope._config[e])?o.bind(window.Upscope._config):o:window.Upscope._config}function b(){return window.upscope___currentLocation?upscope___currentLocation():location}var o="";try{o=localStorage.getItem("debug").split("*").join("")}catch(e){}function u(t){return function(){var e;o&&("upscope:"+t).startsWith(o)&&((e=Array.prototype.slice.call(arguments)).unshift("[upscope debug : "+t+"]"),(console.__original__debug||console.debug).apply(console,e))}}function k(){var e=Array.prototype.slice.call(arguments),t=e.shift();(window.Upscope._config.consoleAllowed?(e.unshift("[Upscope]"),console["__original__"+t]||console[t]):u("console")).apply(console,e)}!function n(s,i,r){function a(t,e){if(!i[t]){if(!s[t]){var o="function"==typeof l&&l;if(!e&&o)return o(t,!0);if(c)return c(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}o=i[t]={exports:{}},s[t][0].call(o.exports,function(e){return a(s[t][1][e]||e)},o,o.exports,n,s,i,r)}return i[t].exports}for(var c="function"==typeof l&&l,e=0;e<r.length;e++)a(r[e]);return a}({1:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=e("./utils.js"),s=e("./modules/dialogs.js"),e={beta:!1,region:null,dataEndpoint:(0,n.baseEndpoint)("data",3005,"ws")+"/session",pageviewsEndpoint:(0,n.baseEndpoint)("data-collection",3005)+"/pageviews",phoneEndpoint:(0,n.baseEndpoint)("phone",3007),javascriptEndpoint:(0,n.baseEndpoint)("js",3002),storageImplementation:null,proxyRedirectEndpoint:(0,n.baseEndpoint)("app",3e3)+"/session?token=TOKEN&url=URL",requireAuthorizationForSession:!1,integrateWithLivechat:!0,liveChatRewrite:!0,grabIdentityFromLivechat:!0,showUpscopeLink:!0,cursorColor:"black",enlargeCursor:!1,showTerminateButton:!0,useFingerprinting:!0,autoconnect:!0,trackConsole:!1,allowRemoteConsole:!1,allowRemoteClick:!0,allowRemoteScroll:!0,allowRemoteType:!0,allowAgentRedirect:!0,rewriteExternalLinks:!1,collectHistory:!1,consoleAllowed:!0,drawingsTtlMs:6e3,enableLookupCodeOnKey:!1,lookupCodeKey:17,lookupCodeKeyRepetitions:5,lookupCodeKeyTitle:"Co-browsing access code",lookupCodeKeyMessage:"Please give the agent this code: {%lookupCode%}",lookupCodeElement:null,injectLookupCodeButton:!1,lookupCodeButtonPages:["*"],lookupCodeButtonStyle:"left: 0;bottom: 100px;",disconnectAfterSeconds:900,proxyAssets:["*://localhost/*","*://localhost:*/*","*://127.0.0.1/*","*://127.0.0.1:*/*","*://*.dev/*","*://*.dev:*/*"],maskedElements:[],domChangesDelay:100,ignoreBrowserSupport:"extension"!==window.__upscopeContext__&&"off"===localStorage.getItem("upscope:browserDetect"),enableCanvases:!0,customCallController:null,callPromptText:"Would you like to join the voice call?",callRingtone:(0,n.isProduction)()?"https://js.upscope.io/assets-1.17.14/ringtone.mp3":"http://localhost:3002/assets/ringtone.mp3",authorizationPromptTitle:"Co-browsing request",authorizationPromptMessage:"Would you like to let {%agentName%|our agent} help you navigate {%currentDomain%}?",endOfScreenshareMessage:null,callWaitMessage:"Please stay on this page. Our agent will call you here shortly.",translationsYes:"Yes",translationsNo:"No",translationsOk:"Okay",translationsStopSession:"End session",agentRequestButtonStyle:"left: 10px;bottom: 10px;",agentRequestButtonTitle:"Request agent help",agentRequestButtonSubtitle:"An agent can screen share with you now",agentRequestButtonRequestingTitle:"Looking for an available agent...",agentRequestButtonRequestingSubtitle:"Click to cancel request",agentRequestResultTitle:"Agent request",agentRequestNotAvailableText:"An agent is not currently available. Please try again later.",agentRequestAcceptedText:"An agent will screen share with you shortly. Please stay on this page.",showAgentRequestButton:"never",agentRequestButtonPages:["*"],unavailableAgentRequestRedirectImmediately:!1,unavailableAgentRequestRedirectTo:null,fromProxy:!1,sfdcFieldLabel:"Screen_Share",sfdcFieldId:"Screen_Share__c",baseProxyUrl:(0,n.isProduction)()?"https://APIKEY.upscopeproxy.com":(0,n.isStaging)()?"https://APIKEY.upscopeproxy.xyz":"http://APIKEY.local.upscopeproxy.xyz",proxyDomain:(0,n.isProduction)()?".upscopeproxy.com":(0,n.isStaging)()?".upscopeproxy.xyz":".local.upscopeproxy.xyz",needsProxy(e){return!!this.fromProxy||("pdf"===(e=new URL(e,location.href)).pathname.split(".").pop()||!e.hostname.endsWith(location.hostname)&&!location.hostname.endsWith(e.hostname))},onSessionRequest(e,t){k("info","Screen sharing request received");let o;o=(o=this.authorizationPromptMessage.includes("{%agentName%|")?t?this.authorizationPromptMessage.split("{%agentName%|").map((e,t)=>0===t?e:e.slice(Math.max(0,e.indexOf("}")+1))).join(t):this.authorizationPromptMessage.split("{%agentName%|").map((e,t)=>0===t?e:e.slice(0,Math.max(0,e.indexOf("}")))+e.slice(Math.max(0,e.indexOf("}")+1))).join(""):this.authorizationPromptMessage).split("{%currentDomain%}").join(b().host),(0,s.confirm)(this.authorizationPromptTitle,o).then(e)},onSessionStart(){k("info","Screen sharing started")},onSessionEnd(){k("info","Screen sharing ended"),this.endOfScreenshareMessage&&(0,s.alert)(this.endOfScreenshareMessage)},onWaitingForCall(){k("info","Found call name"),this.callWaitMessage&&(0,s.alert)(this.callWaitMessage)},onSessionContinue(){k("info","Screen sharing continued")},onConnection:null,maskElementMiddleware(e){if("password"===e.type||"function"==typeof e.getAttribute&&"cc-number"===e.getAttribute("autocompletetype"))return!0;for(;e;){for(const t of this.maskedElements){if("function"==typeof e.matches&&e.matches(t))return!0;if("function"==typeof e.msMatchesSelector&&e.msMatchesSelector(t))return!0}if(e.className&&/\bno-upscope\b/.test(e.className))return!0;e=e.parentNode}return!1},noRemoteElements:[],allowRemoteMiddleware(e){if(this.maskElementMiddleware(e))return!1;for(;e;){for(const t of this.noRemoteElements){if("function"==typeof e.matches&&e.matches(t))return!1;if("function"==typeof e.msMatchesSelector&&e.msMatchesSelector(t))return!1}e=e.parentNode}return!0},styleSheetContentFromRules(e){return"STYLE"===e.tagName&&!e.href&&0===e.textContent.trim().length}};o.default=e},{"./modules/dialogs.js":26,"./utils.js":55}],2:[function(e,t,o){!function(l){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.NODE_TYPES=void 0,o.checkIframeAccess=r,o.doForIframes=function(e,t,o,n=!1){e=e.querySelectorAll("iframe,frame");for(const s of e)if(n||i(s))if(s.__upscopeChildFrameHandler)o&&o(s,s.__upscopeChildFrameHandler);else{let e=!1;try{void 0!==s.contentWindow&&r(s)&&(e=!0)}catch(e){l("Skipping iframe %o due to error %o",s,e)}e&&t(s)}},o.doForShadowRoots=function(e,t){e=c(e);for(const o of e)o.shadowRoot&&t(o.shadowRoot)},o.elementForCoordinates=function(e,t,o=[]){let n=document;for(;n===document||n&&n.contentDocument;){var s,i;n!==document&&({top:s,left:i}=n.getBoundingClientRect(),e-=i,t-=s);const r=n===document?document:n.contentDocument;if(n=r.elementFromPoint(e,t),o.includes(n)&&document.elementsFromPoint){for(const a of r.elementsFromPoint(e,t))if(n=null,!o.includes(a)){n=a;break}}else o.includes(n)&&(n=null)}return n},o.elementId=function e(t,o){if("ELEMENT_NODE"===n[t.nodeType]||"DOCUMENT_FRAGMENT_NODE"===n[t.nodeType])return s(t);o=o||t.parentNode;for(;t;){if("ELEMENT_NODE"===n[t.nodeType])return null===e(t)?null:e(t)+"+";t=t.previousSibling}return null===s(o)?null:s(o)+"^"},o.elementParents=function(e){const t=[];for(;e;)t.unshift(e),e=e.parentNode;return t},o.encodeAnimation=function(e){var t=e.effect.getTiming(),t={delay:t.delay,direction:t.direction,duration:t.duration,easing:t.easing,endDelay:t.endDelay,fill:t.fill,iterationStart:t.iterationStart,iterations:t.iterations===Number.POSITIVE_INFINITY?"::infinity::":t.iterations},e=e.effect.getKeyframes();return{options:t,keyframes:e}},o.findAllUrlsInCss=function(e){const t=[];let[o,n]=a(e);for(;void 0!==o;){var s=e.indexOf(o)+o.length,i=e.slice(s).indexOf(n),r=i+s;if(-1===s||-1===i)break;s=e.slice(s,s+i),i=e.slice(r+n.length);t.includes(s)||t.push(s),e=i,[o,n]=a(e)}return t},o.getAllElements=c,o.getAttributes=function(e){const t={};for(const o of e.attributes)t[o.name]=o.value;return t},o.getMergedTextNodes=function(e){let t=e,o="TEXT_NODE"===n[e.nodeType]?e.textContent:"";for(;null!==(t=t.previousSibling);)if("TEXT_NODE"===n[t.nodeType])o=t.textContent+o;else if("COMMENT_NODE"!==n[t.nodeType])break;t=e;for(;null!==(t=t.nextSibling);)if("TEXT_NODE"===n[t.nodeType])o+=t.textContent;else if("COMMENT_NODE"!==n[t.nodeType])break;return o},o.isScrollable=function(t){if(void 0!==t.__upscopeScrollable)return t.__upscopeScrollable;try{var e=t.scrollWidth>t.clientWidth,o=t.scrollHeight>t.clientHeight,n=t.ownerDocument.defaultView.getComputedStyle(t),s=n["overflow-x"],i=n["overflow-y"];return t.__upscopeScrollable=e&&"hidden"!==s||o&&"hidden"!==i,t.__upscopeScrollable}catch(e){return l("Error detecting scrollability of %o (%o)",t,e),t.__upscopeScrollable=!1}},o.isVisible=i,o.windowScrollX=function(e){return void 0===e.pageXOffset?(e.document.documentElement||e.document.body.parentNode||e.document.body).scrollLeft:e.pageXOffset},o.windowScrollY=function(e){return void 0===e.pageYOffset?(e.document.documentElement||e.document.body.parentNode||e.document.body).scrollTop:e.pageYOffset};const n={1:"ELEMENT_NODE",2:"ATTRIBUTE_NODE",3:"TEXT_NODE",4:"CDATA_SECTION_NODE",7:"PROCESSING_INSTRUCTION_NODE",8:"COMMENT_NODE",9:"DOCUMENT_NODE",10:"DOCUMENT_TYPE_NODE",11:"DOCUMENT_FRAGMENT_NODE"};function s(e){return e&&void 0!==e.__upscopeID?e.__upscopeID:e&&"DOCUMENT_FRAGMENT_NODE"===n[e.nodeType]&&void 0!==e.__upscopeRootId?e.__upscopeRootId+"-sr":null}function i(t){try{var{top:e,bottom:o,height:n,width:s}=t.getBoundingClientRect(),{display:i,visibility:r,opacity:a}=t.ownerDocument.defaultView.getComputedStyle(t),c=Math.max(t.ownerDocument.documentElement.clientHeight,t.ownerDocument.defaultView.innerHeight);return 0<=o&&e-c<0&&5<n&&5<s&&"none"!==i&&"hidden"!==r&&"0"!==a}catch(e){return l("Error detecting visibility of %o (%o)",t,e),!0}}function r(t){var e="upscope__iframe__access";if("upscopeStorageFrame"!==t.id&&!(y("maskElementMiddleware")(t)||void 0!==t.__upscopeFailingAccessAt&&Date.now()-t.__upscopeFailingAccessAt<Math.min(500*t.__upscopeFailingCount,5e3))){t.__upscopeFailingAccessAt=new Date,t.__upscopeFailingCount=t.__upscopeFailingCount||0,t.__upscopeFailingCount++;try{const o=t.contentWindow;if((o[e]="iframeAccessOn")===o[e])return delete t.__upscopeFailingAccessAt,delete t.__upscopeFailingCount,!0}catch(e){l("Error accessing iframe %o (%o)",t,e)}}return!1}function a(e){var t,o,n;let s,i,r;for([t,o,n]of[["url('","')",!1],['url("','")',!1],["url(",")",!1],["'","'",!0],['"','"',!0]])n&&(e.slice(0,1)!==e.slice(-1,0)||e.slice(-1,0)!==t)||n&&!("/"===e.slice(1,2)||".."===e.slice(1,3)||"http"===e.slice(1,5)||e.includes("/")&&e.includes(".")&&"."!==e.slice(-1,0)&&"/"!==e.slice(-1,0))||e.includes(t)&&(void 0===s||s>e.indexOf(t))&&(s=e.indexOf(t),i=t,r=o);return[i,r]}function c(e){return e.getElementsByTagName?e.getElementsByTagName("*"):e.querySelectorAll("*")}o.NODE_TYPES=n}.call(this,u("upscope:dom-utils.js"))},{}],3:[function(t,e,o){!function(n){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.collectAsset=async function(t,o){if(n("Collecting asset %s (element: %o)",t,o),y("beta"))try{if(o&&"[object HTMLImageElement]"===Object.prototype.toString.apply(o))return s(o).replace(/^data:/,"").replace(",",":");if(o&&"[object CSSStyleSheet]"===Object.prototype.toString.apply(o))return i(o).replace(/^data:/,"").replace(",",":")}catch(e){n("Unable to collect image / css for %o (%o), using fetch",o,e)}try{return await(0,e.timeout)(new Promise((i,r)=>{const a=new XMLHttpRequest;a.open("GET",t,!0),a.responseType="arraybuffer",a.addEventListener("load",function(e){if(200!==this.status)return r(this.status,this.response);var t=new Uint8Array(this.response);let o=t.length;const n=new Array(o);for(;o--;)n[o]=String.fromCharCode(t[o]);var s=n.join("");i(a.getResponseHeader("content-type")+":"+window.btoa(s))}),a.send()}),5e3)}catch(e){n("Could not collect asset %s (%o)",t,e)}},o.getDataUrl=s,o.getStylesheetContent=i;var e=t("../utils.js");function s(e,t=0){const o=e.ownerDocument,n=o.upscopePseudoCanvas||o.createElement("canvas");(o.upscopePseudoCanvas=n).getContext("2d").clearRect(0,0,n.width,n.height);var s={0:1200,.5:900,1:600,2:100}[t],t={0:.8,.5:.6,1:.6,2:.2}[t];if("CANVAS"===e.tagName&&(n.width=Math.min(e.width,s),n.height=e.height/e.width*n.width,n.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,n.width,n.height)),"IMG"===e.tagName){if(0===e.naturalWidth)throw new Error("Image is not loaded");if(e.currentSrc&&e.currentSrc!==e.src)throw new Error("Image is using srcset entry");n.width=Math.min(e.naturalWidth,s),n.height=e.naturalHeight/e.naturalWidth*n.width,n.getContext("2d").drawImage(e,0,0,e.naturalWidth,e.naturalHeight,0,0,n.width,n.height)}return"VIDEO"===e.tagName&&(n.width=Math.min(e.videoWidth,s),n.height=e.videoHeight/e.videoWidth*n.width,n.getContext("2d").drawImage(e,0,0,e.videoWidth,e.videoHeight,0,0,n.width,n.height)),n.toDataURL("image/webp",t)}function i(e){let t="";for(const o of e.cssRules||e.rules)o.cssText&&(t+=o.cssText);return t}}.call(this,u("upscope:modules/assets-utils.js"))},{"../utils.js":55}],4:[function(e,t,n){!function(f){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var g=e("../dom-utils.js"),c=e("../utils.js"),u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};t=r(t);if(t&&t.has(e))return t.get(e);var o,n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e){var i;"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&((i=s?Object.getOwnPropertyDescriptor(e,o):null)&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=e[o])}n.default=e,t&&t.set(e,n);return n}(e("./internal-elements-css.js"));function r(e){var t,o;return"function"!=typeof WeakMap?null:(t=new WeakMap,o=new WeakMap,(r=function(e){return e?o:t})(e))}const o={"#upscope___overlay":{display:"none",position:"fixed","z-index":"2147483646",width:"10000px",height:"10000px",top:"-5000px",left:"-5000px",opacity:"0","pointer-events":"none",transition:"opacity 0.3s","-webkit-transition":"opacity 0.3s",background:'url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwMDBweCIgaGVpZ2h0PSIxMDAwMHB4IiB2aWV3Qm94PSIwIDAgMTAwMDAgMTAwMDAiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+DQogIDxnIGlkPSJvdmVybGF5IiBmaWxsPSIjMDAwMDAwIj4NCiAgICAgIDxwYXRoIGQ9Ik0wLDAgTDEwMDAwLDAgTDEwMDAwLDEwMDAwIEwwLDEwMDAwIEwwLDAgTDAsMCBaIE01MDAwLDUwNTQgQzUwMjkuODIzMzgsNTA1NCA1MDU0LDUwMjkuODIzMzggNTA1NCw1MDAwIEM1MDU0LDQ5NzAuMTc2NjIgNTAyOS44MjMzOCw0OTQ2IDUwMDAsNDk0NiBDNDk3MC4xNzY2Miw0OTQ2IDQ5NDYsNDk3MC4xNzY2MiA0OTQ2LDUwMDAgQzQ5NDYsNTAyOS44MjMzOCA0OTcwLjE3NjYyLDUwNTQgNTAwMCw1MDU0IEw1MDAwLDUwNTQgWiIgaWQ9ImlubmVyLWNpcmNsZSI+PC9wYXRoPg0KICA8L2c+DQo8L3N2Zz4=")',"background-size":"50000px 50000px","background-position":"center center"},"#upscope___overlay.upscope___overlay--show":{opacity:"0.4",transition:"background-size 0.3s linear, opacity 0.3s, top 0.1s, left 0.1s","-webkit-transition":"background-size 0.3s linear, opacity 0.3s, top 0.1s, left 0.1s","background-size":"10000px 10000px"},"#upscope___overlay.upscope___overlay--white":{background:'url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwMDAiIGhlaWdodD0iMTAwMDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNMCAwaDEwMDAwdjEwMDAwSDBWMHptNTAwMCA1MDU0YzI5LjggMCA1NC0yNC4yIDU0LTU0cy0yNC4yLTU0LTU0LTU0LTU0IDI0LjItNTQgNTQgMjQuMiA1NCA1NCA1NHoiIGZpbGw9IiNGRkYiIGZpbGwtcnVsZT0ibm9uemVybyIvPjxwYXRoIGQ9Ik01MDAwIDUwNTRjMjkuOCAwIDU0LTI0LjIgNTQtNTRzLTI0LjItNTQtNTQtNTQtNTQgMjQuMi01NCA1NCAyNC4yIDU0IDU0IDU0eiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjYiLz48L2c+PC9zdmc+")'},"#upscope___overlay.upscope___overlay--white.upscope___overlay--show":{opacity:"0.4"},".upscope___svg":{"pointer-events":"none",position:"fixed",top:"0",left:"0",width:"100%",height:"100%","z-index":"2147483645"},"#upscope___drag-protection":{position:"fixed",top:"0",left:"0",width:"100%",height:"100%","z-index":"2147483645",display:"none"},"@keyframes upscope___svg____line__animation":{from:{"stroke-dashoffset":"10000"},to:{"stroke-dashoffset":"0"}},".upscope___svg___line":{fill:"none","stroke-width":"14px","stroke-linecap":"round","stroke-linejoin":"round",opacity:"0.6","stroke-dasharray":"10000","stroke-dashoffset":"0",transition:"opacity 1s",animation:"upscope___svg____line__animation 5s forwards"},".upscope___svg___line.upscope___svg___line--disappear":{opacity:"0","stroke-dashoffset":"0","stroke-dasharray":"0"},".upscope___svg___line.upscope___svg___line--gone":{display:"none",opacity:"0"}};n.default=class{constructor(e,t){this.initiated=!1,this.hidePointerTimeout=null,this.connection=e,this.consoleHandler=t,this.pointerObserver=null,this.pointerPosition={x:0,y:0},this.cursors={},this.blurTimeouts={}}init(){this.initiated||(f("Initiating browser instructions receiver"),this._injectElements(),this.initiated=!0)}observerGone(e){this.pointerObserver===e&&(this.pointerObserver=null,this.hidePointer()),this.cursors[e]&&this.hideCursor(e)}receiveInstruction(e){switch(this._injectElements(),e.action){case"dataBounce":this.connection._dataBounce(e.data);break;case"scroll":this.scroll(e.elementId,e.x,e.y);break;case"click":this.click(e.elementId,e.observerId,e.x,e.y);break;case"dragStart":this.dragStart(e.elementId,e.observerId,e.x,e.y);break;case"dragEnd":this.dragEnd(e.observerId,e.x,e.y);break;case"type":this.type(e.elementId,e.observerId,e.newValue);break;case"drawLine":this.drawLine(e.lineData);break;case"sendSnapshot":e.forceAssets&&y("proxyAssets",["*"]),this.connection.sendSnapshot();break;case"showPointer":this.pointerObserver=e.observerId,this.showPointer();break;case"hidePointer":this.pointerObserver=null,this.hidePointer();break;case"movePointer":this.movePointer(e.x,e.y);break;case"showCursor":this.showCursor(e.color,e.agentName,e.observerId);break;case"hideCursor":this.hideCursor(e.observerId);break;case"moveCursor":this.moveCursor(e.x,e.y,e.color,e.agentName,e.observerId);break;case"reload":this.reload();break;case"redirect":this.redirect(e.url);break;case"console":y("allowRemoteConsole")?this.consoleHandler.execute(e.command):k("error","Remote console not enabled");break;default:k("error","Browser instruction not recognized",e)}}scroll(e,t,o){if(!y("allowRemoteScroll"))return k("error","Remote scroll disabled");var n=window.scrollX,s=window.scrollY,i=document.querySelectorAll("html")[0];let r=this._selectElement(e);var a=r;if(!r)return f("Element not found during scroll (%s)",e);for(;r!==i;){if((0,g.isScrollable)(r)&&(0!==o&&0<r.scrollTop+o&&r.scrollTop+o+r.clientHeight<r.scrollHeight||0!==t&&0<r.scrollLeft+t&&r.scrollLeft+t+r.clientWidth<r.scrollWidth)){var c=r.scrollTop,l=r.scrollLeft;if(r.scrollTop+=o,r.scrollLeft+=t,t-=r.scrollLeft-l,0===(o-=r.scrollTop-c)&&0===t)return}if(r.parentNode===r.ownerDocument){const u=r.ownerDocument.__upscopeRootId,d=r.ownerDocument.defaultView.parent.document,p=d.querySelectorAll("iframe,frame");for(const h of p)if(h.__upscopeID===u){r=h;break}}else r=r.parentNode}window.scrollTo(n+t,s+o),t-=window.scrollX-n,o-=window.scrollY-s,0===t&&0===o||this._dispatchEvent(a,WheelEvent,"wheel",{deltaX:t,deltaY:o})}dragStart(e,t,o,n){if(!y("allowRemoteClick"))return k("error","Remote click disabled");var s=this._selectElement(e);if(!s)return f("Element not found during click (%s)",e);if(s.__upscopeNoRemoteControl)return f("Remote clicking not allowed on this element");if(!this.cursors[t])return f("Cursor not active, ignored dragStart");if(this.cursors[t].dragging)return f("Already dragging, ignored dragStart");this.cursors[t].dragging=s,this.dragProtectionElement&&(this.dragProtectionElement.style.display="block");for(const r of["mouseover","mouseenter","mousedown"])this._dispatchEvent(s,MouseEvent,r,o,n);var i=this._findDraggable(s);if(i){this.cursors[t].dragging=i,this.cursors[t].dataTransfer="function"==typeof DataTransfer?new DataTransfer:null;for(const a of["drag","dragstart"])this._dispatchEvent(i,DragEvent,a,o,n,{dataTransfer:this.cursors[t].dataTransfer})}}_findDraggable(e){do{if(e.draggable)return e}while(e=e.parentNode)}dragEnd(e,t,o){if(!this.cursors[e]||!this.cursors[e].dragging)return f("Ignoring dragEnd (not dragging)");if(this.cursors[e].dragging&&this.cursors[e].dragging.draggable){for(const n of["mousemove","mouseup"])this._dispatchEvent(this.cursors[e].dragging,MouseEvent,n,t,o);this._dispatchEvent(this.cursors[e].dragging,DragEvent,"dragend",t,o,{dataTransfer:this.cursors[e].dataTransfer}),this.cursors[e].previousHover&&this._dispatchEvent(this.cursors[e].previousHover,DragEvent,"drop",t,o,{dataTransfer:this.cursors[e].dataTransfer})}else if(this.cursors[e].previousHover)for(const s of["mousemove","mouseup","click"])this._dispatchEvent(this.cursors[e].previousHover,MouseEvent,s,t,o);this.dragProtectionElement&&(this.dragProtectionElement.style.display="none"),delete this.cursors[e].dragging,delete this.cursors[e].dataTransfer}click(e,t,o,n){if(!y("allowRemoteClick"))return k("error","Remote click disabled");const s=this._selectElement(e);if(!s)return f("Element not found during click (%s)",e);if(s.__upscopeNoRemoteControl)return f("Remote clicking not allowed on this element");if(this.cursors[t]&&this.cursors[t].element&&this.cursors[t].element.clickAnimation(),Boolean(window.MSInputMethodContext)&&Boolean(document.documentMode))return s.click();s.ownerDocument.activeElement!==s&&s.ownerDocument.activeElement!==s.ownerDocument.body&&this._dispatchEvent(s.ownerDocument.activeElement,Event,"blur");for(const i of["mouseover","mouseenter","mousedown","mouseup","click"])this._dispatchEvent(s,MouseEvent,i,o,n);this.isDoubleclick=this.isDoubleclick||{},this.isDoubleclick[t]?(this._dispatchEvent(s,MouseEvent,"dblclick",o,n),delete this.isDoubleclick[t]):(this.isDoubleclick[t]=!0,setTimeout(()=>delete this.isDoubleclick[t],200))}type(e,t,o){if(!y("allowRemoteType"))return k("error","Remote typing disabled");const n=this._selectElement(e);if(!n)return f("Element not found during click (%s)",e);if(n.__upscopeNoRemoteControl)return f("Remote typing not allowed on this element");this.blurTimeouts[e]||(this._dispatchEvent(n,FocusEvent,"focus"),this._dispatchEvent(n,FocusEvent,"focusin"));var s=n.value;n.value=o;const i=n._valueTracker;if(i&&i.setValue&&i.setValue(s),"INPUT"===n.tagName||"TEXTAREA"===n.tagName){const r=o.slice(-1),a=r.charCodeAt(0);this._dispatchEvent(n,KeyboardEvent,"keydown",{which:a,key:r}),this._dispatchEvent(n,KeyboardEvent,"keypress",{which:a,key:r}),this._dispatchEvent(n,KeyboardEvent,"keyup",{which:a,key:r}),this._dispatchEvent(n,KeyboardEvent,"input")}else"SELECT"===n.tagName&&this._dispatchEvent(n,Event,"change");clearTimeout(this.blurTimeouts[e]),this.blurTimeouts[e]=setTimeout(()=>{this._dispatchEvent(n,FocusEvent,"blur"),this._dispatchEvent(n,FocusEvent,"focusout"),delete this.blurTimeouts[e]},800)}showPointer(){f("Showing pointer"),this.hidePointerTimeout&&clearTimeout(this.hidePointerTimeout),this.overlayElement.style.display="block",this.overlayElement.style.top=this.pointerPosition.y-5e3+"px",this.overlayElement.style.left=this.pointerPosition.x-5e3+"px;",this.hidePointerTimeout=setTimeout(()=>{this.overlayElement.className="upscope___overlay--show"},20)}hidePointer(){f("Hiding pointer"),this.overlayElement.className="",this.hidePointerTimeout=setTimeout(()=>{this.overlayElement.style.display="none"},300)}movePointer(e,t){this.pointerPosition={x:Number.parseInt(e,10),y:Number.parseInt(t,10)},this.overlayElement.style.left=this.pointerPosition.x-5e3+"px",this.overlayElement.style.top=` ${this.pointerPosition.y-5e3}px`,this.overlayElement.style.display="block"}hideCursor(e){f("Hiding pointer"),this.cursors[e]&&(this.cursors[e].dragging&&this.dragEnd(e,0,0),this.cursors[e].disableTimeout&&clearTimeout(this.cursors[e].disableTimeout),this.cursors[e].previousHover&&(this._dispatchEvent(this.cursors[e].previousHover,MouseEvent,"mouseleave"),this._dispatchEvent(this.cursors[e].previousHover,MouseEvent,"mouseout")),this.cursors[e].element&&this.cursors[e].element.remove(),delete this.cursors[e])}hideAll(){this.hidePointer();for(const e in this.cursors)this.cursors.hasOwnProperty(e)&&this.hideCursor(e)}moveCursor(t,o,e,n,s){if(this.cursors[s]=this.cursors[s]||{},this.cursors[s].position={x:Number.parseInt(t,10),y:Number.parseInt(o,10)},this.cursors[s].element||(f("Showing pointer"),this.cursors[s].element=this._injectCursor(e,n||"Agent",s)),this.cursors[s].element.style.zIndex="2147483646",this.cursors[s].element.style.pointerEvents="none",this.cursors[s].element.style.position="fixed",this.cursors[s].element.style.top=this.cursors[s].position.y+"px",this.cursors[s].element.style.left=this.cursors[s].position.x+"px",this.cursors[s].disableTimeout&&clearTimeout(this.cursors[s].disableTimeout),this.cursors[s].disableTimeout=setTimeout(()=>{this.hideCursor(s)},2e4),y("allowRemoteClick")||y("allowRemoteScroll")){this.cursors[s].dragging&&this._dispatchEvent(this.cursors[s].dragging,MouseEvent,"mousemove",t,o);var i=(0,g.elementForCoordinates)(t,o,[this.cursors[s].dragging,this.dragProtectionElement]);if(this.cursors[s].previousHover&&i!==this.cursors[s].previousHover){this.cursors[s].dragging&&this.cursors[s].dragging.draggable&&this._dispatchEvent(this.cursors[s].previousHover,DragEvent,"dragleave",t,o,{dataTransfer:this.cursors[s].dataTransfer}),this._dispatchEvent(this.cursors[s].previousHover,MouseEvent,"mouseout",t,o,{relatedTarget:i||null});let e=this.cursors[s].previousHover;for(;e;)i&&e.contains&&e.contains(i)||this._dispatchEvent(e,MouseEvent,"mouseleave",t,o,{relatedTarget:i||null}),e=e.parentElement}if(i){if(i!==this.cursors[s].previousHover){this.cursors[s].dragging&&this.cursors[s].dragging.draggable&&(this._dispatchEvent(i,DragEvent,"dragover",t,o,{dataTransfer:this.cursors[s].dataTransfer}),this._dispatchEvent(i,DragEvent,"dragenter",t,o,{dataTransfer:this.cursors[s].dataTransfer})),this._dispatchEvent(i,MouseEvent,"mouseover",t,o,{relatedTarget:this.cursors[s].previousHover||null});let e=i;for(;e;)this.cursors[s].previousHover&&e.contains&&e.contains(this.cursors[s].previousHover)||this._dispatchEvent(e,MouseEvent,"mouseenter",t,o,{relatedTarget:this.cursors[s].previousHover||null}),e=e.parentElement}this._dispatchEvent(i,MouseEvent,"mousemove",t,o)}this.cursors[s].previousHover=i}}drawLine(e){const t=document.createElementNS("http://www.w3.org/2000/svg","svg"),o=(t.setAttributeNS(null,"class","upscope___svg"),this.container.append(t),document.createElementNS("http://www.w3.org/2000/svg","path"));o.setAttributeNS(null,"class","upscope___svg___line"),o.setAttributeNS(null,"d",e.path),o.setAttributeNS(null,"stroke",e.color),t.append(o),clearTimeout(this.clearPathsTimeout),this.clearPathsTimeout=setTimeout(()=>{for(const e of this.container.querySelectorAll(".upscope___svg"))e.__removed||(e.__removed=!0,e.querySelector(".upscope___svg___line").setAttributeNS(null,"class","upscope___svg___line upscope___svg___line--disappear"),setTimeout(()=>{e.remove()},2e3))},y("drawingsTtlMs"))}redirect(t){if(!y("allowAgentRedirect"))return k("error","Agent URL changes are not allowed");if(!/^http(s)?:\/\//.test(t))return k("warn","Invalid redirect URL");if(t.includes("?")){let e=t.slice(t.indexOf("?")+1);e=e.replace(/[&?]__upscope_[A-z_]+=[\w.\d]+/g,""),t=t.slice(0,Math.max(0,t.indexOf("?")))+"?"+e}t+=(t.includes("?")?"&":"?")+"__upscope_short_id="+this.connection.shortId,y("needsProxy")(t)&&(t=y("fromProxy")?location.origin+"/"+t:y("proxyRedirectEndpoint").replace("URL",encodeURIComponent(t)).replace("TOKEN",encodeURIComponent(this.connection.proxyToken))),location.href=t}reload(){if(!y("allowAgentRedirect"))return k("error","Agent URL changes are not allowed");location.reload()}_selectElement(n){try{const s=n.split(">"),i=[];let e=document,t=null,o=s.shift();for(;o;){i.push(o);for(const r of(0,g.getAllElements)(e))if(r.__upscopeID===i.join(">")){t=r;break}(o=s.shift())&&(e=t.contentDocument||t.shadowRoot)}return t}catch(e){return f("Error selecting element "+n+" (%o)",e),null}}_dispatchEvent(t,o,n,s=null,i=null,r={}){try{let e={};"object"==typeof s?e=s:null!==s&&(e={clientX:s,clientY:i,layerX:s,layerY:i,offsetX:s,offsetY:i,pageX:s+(0,c.attempt)(()=>t.ownerDocument.defaultView.scrollX,0),pageY:i+(0,c.attempt)(()=>t.ownerDocument.defaultView.scrollY,0),...r});const a=new o(n,{view:t.ownerDocument.defaultView,bubbles:!0,cancelable:!0,...e});a.isUpscopeBrowserInstruction=!0,t.dispatchEvent(a)}catch(e){f("Error dispatching event %o",e)}}_injectElements(){if(!this.container||!document.getElementById("upscope___remote-control-container")){this.container=(0,u.default)(document,o,{id:"upscope___remote-control-container"}),f("Injecting overlay element");const e=document.createElement("div"),t=(e.id="upscope___overlay",this.container.append(e),this.overlayElement=e,f("Injecting drag protection overlay"),document.createElement("div"));t.id="upscope___drag-protection",this.container.append(t),this.dragProtectionElement=t}y("enlargeCursor")&&!this.enlargeCursorStylesheet&&(this.enlargeCursorStylesheet=document.createElement("style"),this.enlargeCursorStylesheet.id="upscope___enlarge-cursor-stylesheet",this.enlargeCursorStylesheet.textContent=(0,u.objectToCss)({"*":{cursor:`url('data:image/svg+xml;upscope_enlarged_cursor=true;base64,${btoa(`<svg width="29px" height="39px" viewBox="0 0 29 39" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M22.0377359,21.3349459 L16.4085968,21.3349459 L19.3824816,28.4981468 C19.4886918,28.7439431 19.4886918,28.9897387 19.3824816,29.2355351 C19.2762715,29.4813315 19.0992548,29.6568998 18.8514308,29.762241 L16.2492816,30.9209941 C16.0368612,31.0263353 15.8067394,31.0263353 15.5589154,30.9209941 C15.3110914,30.8156529 15.1340748,30.6400845 15.0278646,30.3942882 L12.213295,23.5997815 L7.59315257,28.2874644 C7.30992572,28.603488 6.97359297,28.6737151 6.58415594,28.4981468 C6.19471892,28.3225784 6,28.0241114 6,27.6027467 L6,4.9543911 C6,4.53302635 6.19471892,4.24333808 6.58415594,4.0853263 C6.97359297,3.92731451 7.30992572,3.98876381 7.59315257,4.26967338 L22.728102,19.7021575 C23.0113289,19.9830671 23.0732851,20.3254259 22.9139698,20.7292341 C22.7546546,21.1330423 22.4625766,21.3349459 22.0377359,21.3349459 Z" id="path-1"></path><filter x="-52.9%" y="-25.9%" width="205.9%" height="166.7%" filterUnits="objectBoundingBox" id="filter-2"><feMorphology radius="2" operator="dilate" in="SourceAlpha" result="shadowSpreadOuter1"></feMorphology><feOffset dx="0" dy="2" in="shadowSpreadOuter1" result="shadowOffsetOuter1"></feOffset><feGaussianBlur stdDeviation="2" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur><feComposite in="shadowBlurOuter1" in2="SourceAlpha" operator="out" result="shadowBlurOuter1"></feComposite><feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.5 0" type="matrix" in="shadowBlurOuter1"></feColorMatrix></filter></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="m" fill-rule="nonzero"><use fill="black" fill-opacity="1" filter="url(#filter-2)" xlink:href="#path-1"></use><path stroke="#FFFFFF" stroke-width="2" d="M17.9064919,22.3349459 L20.3004477,28.1014878 C20.5160364,28.6004131 20.5160364,29.1332688 20.3004477,29.632194 C20.0922256,30.114071 19.7263822,30.4769212 19.2582265,30.6757602 L16.6935608,31.8168825 C16.2094267,32.056969 15.6750953,32.056969 15.1677245,31.8413037 C14.683964,31.6356742 14.3181206,31.272824 14.1039943,30.776994 L11.8665846,25.3757789 L8.33784454,28.9548727 C7.76310634,29.5961637 6.95900423,29.764063 6.17316507,29.4097862 C5.42678447,29.0732984 5,28.4191189 5,27.6027467 L5,4.9543911 C5,4.1262685 5.44118974,3.46989866 6.20818129,3.15869635 C6.96247518,2.85264604 7.72495058,2.99195295 8.30710831,3.56948254 L23.4322983,18.9921522 C24.0074862,19.5626341 24.1463989,20.3302428 23.8441901,21.0962358 C23.5352294,21.8793426 22.8761449,22.3349459 22.0377359,22.3349459 L17.9064919,22.3349459 Z" fill="${y("cursorColor")}" fill-rule="evenodd"></path></g></g></svg>`)}') 2 2, default`}}),document.head.append(this.enlargeCursorStylesheet))}_injectCursor(e,t,o){var n=(0,u.objectToCss)({"background-image":`url('data:image/svg+xml;base64,${btoa(`<svg width="29px" height="39px" viewBox="0 0 29 39" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M22.0377359,21.3349459 L16.4085968,21.3349459 L19.3824816,28.4981468 C19.4886918,28.7439431 19.4886918,28.9897387 19.3824816,29.2355351 C19.2762715,29.4813315 19.0992548,29.6568998 18.8514308,29.762241 L16.2492816,30.9209941 C16.0368612,31.0263353 15.8067394,31.0263353 15.5589154,30.9209941 C15.3110914,30.8156529 15.1340748,30.6400845 15.0278646,30.3942882 L12.213295,23.5997815 L7.59315257,28.2874644 C7.30992572,28.603488 6.97359297,28.6737151 6.58415594,28.4981468 C6.19471892,28.3225784 6,28.0241114 6,27.6027467 L6,4.9543911 C6,4.53302635 6.19471892,4.24333808 6.58415594,4.0853263 C6.97359297,3.92731451 7.30992572,3.98876381 7.59315257,4.26967338 L22.728102,19.7021575 C23.0113289,19.9830671 23.0732851,20.3254259 22.9139698,20.7292341 C22.7546546,21.1330423 22.4625766,21.3349459 22.0377359,21.3349459 Z" id="path-1"></path><filter x="-52.9%" y="-25.9%" width="205.9%" height="166.7%" filterUnits="objectBoundingBox" id="filter-2"><feMorphology radius="2" operator="dilate" in="SourceAlpha" result="shadowSpreadOuter1"></feMorphology><feOffset dx="0" dy="2" in="shadowSpreadOuter1" result="shadowOffsetOuter1"></feOffset><feGaussianBlur stdDeviation="2" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur><feComposite in="shadowBlurOuter1" in2="SourceAlpha" operator="out" result="shadowBlurOuter1"></feComposite><feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.5 0" type="matrix" in="shadowBlurOuter1"></feColorMatrix></filter></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="m" fill-rule="nonzero"><use fill="black" fill-opacity="1" filter="url(#filter-2)" xlink:href="#path-1"></use><path stroke="#FFFFFF" stroke-width="2" d="M17.9064919,22.3349459 L20.3004477,28.1014878 C20.5160364,28.6004131 20.5160364,29.1332688 20.3004477,29.632194 C20.0922256,30.114071 19.7263822,30.4769212 19.2582265,30.6757602 L16.6935608,31.8168825 C16.2094267,32.056969 15.6750953,32.056969 15.1677245,31.8413037 C14.683964,31.6356742 14.3181206,31.272824 14.1039943,30.776994 L11.8665846,25.3757789 L8.33784454,28.9548727 C7.76310634,29.5961637 6.95900423,29.764063 6.17316507,29.4097862 C5.42678447,29.0732984 5,28.4191189 5,27.6027467 L5,4.9543911 C5,4.1262685 5.44118974,3.46989866 6.20818129,3.15869635 C6.96247518,2.85264604 7.72495058,2.99195295 8.30710831,3.56948254 L23.4322983,18.9921522 C24.0074862,19.5626341 24.1463989,20.3302428 23.8441901,21.0962358 C23.5352294,21.8793426 22.8761449,22.3349459 22.0377359,22.3349459 L17.9064919,22.3349459 Z" fill="${e}" fill-rule="evenodd"></path></g></g></svg>`)}')`,width:"29px",height:"39px",position:"absolute",top:"-4px",left:"-7px","z-index":"2","pointer-events":"none"}),s=(0,u.objectToCss)({background:e,"box-shadow":"0 2px 4px 0 rgba(0,0,0,0.1)","border-radius":"0 4px 4px 4px",color:"white","font-family":"Arial, sans-serif","letter-spacing":"0.4px",position:"absolute",top:"25px",left:"22px",padding:"0 4px","z-index":"3","font-weight":"700","font-size":"14px","pointer-events":"none","white-space":"nowrap"}),e=(0,u.objectToCss)({background:e,content:"''",position:"absolute",top:"50%",left:"50%",margin:"-35px 0 0 -35px",width:"70px",height:"70px","border-radius":"50%","pointer-events":"none","z-index":"1",opacity:"0",display:"none"});const i=document.createElement("div"),r=document.createElement("div"),a=document.createElement("div"),c=document.createElement("div"),l=(r.style.cssText=n,a.style.cssText=s,c.style.cssText=e,a.textContent=t,i.append(c),i.append(a),i.append(r),i.id="upscope___cursor__"+o,this.container.append(i),[]);return i.clickAnimation=()=>{for(;0<l.length;)clearTimeout(l.pop());c.style.display="none",c.style.transition="none",l.push(setTimeout(()=>{c.style.opacity="0",c.style.transform="scale3d(0, 0, 1)",c.style.transition="all 0.15s"},5),setTimeout(()=>{c.style.display="block",c.style.opacity="0.5"},10),setTimeout(()=>{c.style.opacity="0",c.style.transform="scale3d(1.2, 1.2, 1)"},160))},i}}}.call(this,u("upscope:modules/browser-instructions.js"))},{"../dom-utils.js":2,"../utils.js":55,"./internal-elements-css.js":47}],5:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(e="all"){return!!y("ignoreBrowserSupport")||"function"==typeof window.MutationObserver&&("function"==typeof document.querySelectorAll&&("audio"!==e||"function"==typeof window.RTCDataChannel))}},{}],6:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(e,r){return{detect(e,o){if(r.getAnimations){const s=e=>{e.__upscopeEventSent||"[object Animation]"===Object.prototype.toString.apply(e)&&(e.__upscopeEventSent=!0,o(e))},i=setInterval(()=>{for(const e of r.getAnimations())s(e)},1e3);let t;var n;y("beta")&&(t=r.defaultView.Element.prototype.animate,r.defaultView.Element.prototype.animate=function(...e){e=t.call(this,...e);return s(e),e}),e((n=i,function(){y("beta")&&(r.defaultView.Element.prototype.animate=t),clearInterval(n)}))}},encode(e){var t=n.elementId(e.effect.target),{keyframes:e,options:o}=n.encodeAnimation(e);if(t)return{animationStart:{elementId:t,keyframes:e,options:o}}}}};var n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};t=r(t);if(t&&t.has(e))return t.get(e);var o,n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e){var i;"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&((i=s?Object.getOwnPropertyDescriptor(e,o):null)&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=e[o])}n.default=e,t&&t.set(e,n);return n}(e("../../dom-utils.js"));function r(e){var t,o;return"function"!=typeof WeakMap?null:(t=new WeakMap,o=new WeakMap,(r=function(e){return e?o:t})(e))}},{"../../dom-utils.js":2}],7:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(e,s){return{detect(e,t){s.addEventListener("focusout",t),e((o=t,function(){s.removeEventListener("focusout",o)}));var o,n,t=e=>{"SELECT"!==e.target.tagName||e.target.multiple||e.target.blur()};s.addEventListener("change",t),e((n=t,function(){s.removeEventListener("change",n)}))},encode(e){if(!e.target.__upscopeMasked)return{blur:{elementId:n.elementId(e.target)}}}}};var n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};t=r(t);if(t&&t.has(e))return t.get(e);var o,n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e){var i;"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&((i=s?Object.getOwnPropertyDescriptor(e,o):null)&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=e[o])}n.default=e,t&&t.set(e,n);return n}(e("../../dom-utils"));function r(e){var t,o;return"function"!=typeof WeakMap?null:(t=new WeakMap,o=new WeakMap,(r=function(e){return e?o:t})(e))}},{"../../dom-utils":2}],8:[function(e,t,o){!function(i){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(c,l){return{detect(e,t){const o=setInterval(()=>{try{this.checkUpdates(t)}catch(e){i("Error collecting canvas changes (%o)",e),clearInterval(o)}},200);try{this.checkUpdates(t)}catch(e){i("Error collecting canvas changes (%o)",e)}var n,s;e((n=o,s=this,function(){delete s.canvasUrls,clearInterval(n)}))},checkUpdates(o){var e,t=void 0===this.canvasUrls;t&&(this.canvasUrls={});const n=c._getCanvasUrls(l,2),s=[];if(!t)for(const r in n)n.hasOwnProperty(r)&&(e=n[r],void 0!==this.canvasUrls[r]&&this.canvasUrls[r].length===e.length&&this.canvasUrls[r]===e||s.push(r));if(this.canvasUrls=n,0<s.length){var i=c._getCanvasUrls(l,1);for(const a of s)o({elementId:a,url:i[a]});clearTimeout(this.sendUncompressedTimeout),this.sendUncompressedTimeout=setTimeout(()=>{var e=c._getCanvasUrls(l,0);for(const t of s)o({elementId:t,url:e[t]})},1e3)}},encode(e){return{canvasChange:e}}}}}.call(this,u("upscope:modules/browser-watcher-events/canvas-change.js"))},{}],9:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(e,s){return{detect(e,t){var o,n=e=>{e.isUpscopeBrowserInstruction||t(e)};s.addEventListener("click",n),e((o=n,function(){s.removeEventListener("click",o)}))},encode(e){return{click:{x:e.clientX,y:e.clientY,elementId:e.target.__upscopeMasked?null:n.elementId(e.target)}}}}};var n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};t=r(t);if(t&&t.has(e))return t.get(e);var o,n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e){var i;"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&((i=s?Object.getOwnPropertyDescriptor(e,o):null)&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=e[o])}n.default=e,t&&t.set(e,n);return n}(e("../../dom-utils"));function r(e){var t,o;return"function"!=typeof WeakMap?null:(t=new WeakMap,o=new WeakMap,(r=function(e){return e?o:t})(e))}},{"../../dom-utils":2}],10:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(_,s){const m=s.document;return{detect(e,t){var o,n=y("domChangesDelay")||0;let s=[],i;0<n&&(i=setInterval(()=>{0<s.length&&(t(s),s=[])},n)),this.observer=new MutationObserver(0===n?t:e=>s.push(...e)),this.observer.observe(m,{attributes:!0,childList:!0,characterData:!0,subtree:!0,attributeOldValue:!0});for(const r of v.getAllElements(m))r.shadowRoot&&this.observer.observe(r.shadowRoot,{attributes:!0,childList:!0,characterData:!0,subtree:!0,attributeOldValue:!0});e((o=this.observer,function(){i&&clearInterval(i),o.disconnect()}))},async encode(e){this.mutationBatch=(this.mutationBatch||0)+1;const i=String(this.mutationBatch),r=[],a=[],c=[],l=[],u=[],d=[],p=[],h=[],f=[];for(const t of e){let e=t.target;if(e===m)return{pageLoad:await _.getSnapshot(s)};for(;e;)delete e.__upscopeScrollable,f.push(e),e=e.parentNode||e.host;switch(t.type){case"childList":for(const o of t.addedNodes)a.push(o);if(t.previousSibling){let e=t.previousSibling;for(;e;){if("ELEMENT_NODE"===v.NODE_TYPES[e.nodeType]||"TEXT_NODE"===v.NODE_TYPES[e.nodeType]){c.push(e);break}e=e.previousSibling}}if(t.nextSibling){let e=t.nextSibling;for(;e;){if("ELEMENT_NODE"===v.NODE_TYPES[e.nodeType]||"TEXT_NODE"===v.NODE_TYPES[e.nodeType]){l.push(e);break}e=e.nextSibling}}0<t.removedNodes.length&&0===[...t.target.childNodes].filter(e=>"ELEMENT_NODE"===v.NODE_TYPES[e.nodeType]||"TEXT_NODE"===v.NODE_TYPES[e.nodeType]).length&&u.push(t.target);break;case"attributes":d.push(t.target);break;default:p.push(t.target)}}if(0<p.length+u.length+a.length+c.length+l.length){if(y("beta"))for(const n of a)_._removeIdsFromElement(n,!0);_._ensureHasIds(i,m,m.__upscopeRootId,e=>{e.shadowRoot&&this.observer.observe(e.shadowRoot,{attributes:!0,childList:!0,characterData:!0,subtree:!0,attributeOldValue:!0})})}const g=async function(e){let t,o=[],n;e.shadowRoot&&g(e.shadowRoot);for(const s of e.childNodes)if(("ELEMENT_NODE"===v.NODE_TYPES[s.nodeType]||"TEXT_NODE"===v.NODE_TYPES[s.nodeType]||"DOCUMENT_FRAGMENT_NODE"===v.NODE_TYPES[s.nodeType])&&!s.parentNode.__upscopeMasked){if(n){if(a.includes(s)||"ELEMENT_NODE"!==v.NODE_TYPES[s.nodeType]){n.newNodes.push(await _.encodeNode(s));continue}n.after=v.elementId(s),r.push(n),n=null}else{if(a.includes(s)){n={batch:i,elementId:v.elementId(e),type:"children",newNodes:[await _.encodeNode(s)],before:t?v.elementId(t):null};continue}if(c.includes(s)&&l.includes(s))return void r.push({batch:i,elementId:v.elementId(e),type:"children",newNodes:await _.encodeNode(e).then(e=>e.c)});c.includes(s)?n="ELEMENT_NODE"===v.NODE_TYPES[s.nodeType]?{batch:i,elementId:v.elementId(e),type:"children",newNodes:[],before:v.elementId(s)}:{batch:i,elementId:v.elementId(e),type:"children",newNodes:[await _.encodeNode(s)],before:t?v.elementId(t):null}:l.includes(s)?"ELEMENT_NODE"===v.NODE_TYPES[s.nodeType]?r.push({batch:i,elementId:v.elementId(e),type:"children",newNodes:o,before:t?v.elementId(t):null,after:v.elementId(s)}):n={batch:i,elementId:v.elementId(e),type:"children",newNodes:o,before:t?v.elementId(t):null}:p.includes(s)&&("ELEMENT_NODE"===v.NODE_TYPES[s.nodeType]?r.push({batch:i,elementId:v.elementId(s),type:"html",html:await _.encodeNode(s)}):h.includes(v.elementId(s))||(h.push(v.elementId(s)),r.push({batch:i,elementId:v.elementId(s),type:"text",text:v.getMergedTextNodes(s)})))}u.includes(s)&&r.push({batch:i,elementId:v.elementId(s),type:"children",newNodes:[]}),d.includes(s)&&r.push({batch:i,elementId:v.elementId(s),type:"attributes",attributes:v.getAttributes(s)}),"ELEMENT_NODE"===v.NODE_TYPES[s.nodeType]||"DOCUMENT_FRAGMENT_NODE"===v.NODE_TYPES[s.nodeType]?(t=s,o=[],"SCRIPT"!==s.nodeName&&f.includes(s)&&await g(s)):o.push(await _.encodeNode(s))}n&&r.push(n)};await g(m);e=await _.collectNewAssets(m);return _._activateForWindow(),{domChange:{changes:r,assets:e}}}}};var v=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};t=r(t);if(t&&t.has(e))return t.get(e);var o,n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e){var i;"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&((i=s?Object.getOwnPropertyDescriptor(e,o):null)&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=e[o])}n.default=e,t&&t.set(e,n);return n}(e("../../dom-utils.js"));function r(e){var t,o;return"function"!=typeof WeakMap?null:(t=new WeakMap,o=new WeakMap,(r=function(e){return e?o:t})(e))}},{"../../dom-utils.js":2}],11:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(e,n){return{detect(e,t){var o;n.addEventListener("focusin",t),e((o=t,function(){n.removeEventListener("focusin",o)}))},encode(e){if(!e.target.__upscopeMasked)return{focus:{elementId:s.elementId(e.target)}}}}};var s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};t=r(t);if(t&&t.has(e))return t.get(e);var o,n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e){var i;"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&((i=s?Object.getOwnPropertyDescriptor(e,o):null)&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=e[o])}n.default=e,t&&t.set(e,n);return n}(e("../../dom-utils"));function r(e){var t,o;return"function"!=typeof WeakMap?null:(t=new WeakMap,o=new WeakMap,(r=function(e){return e?o:t})(e))}},{"../../dom-utils":2}],12:[function(s,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n){if(n)return[s("./animation-start").default(e,o),s("./blur").default(e,o),s("./video-status-change").default(e,o),s("./click").default(e,o),s("./dom-change").default(e,t),s("./focus").default(e,o),s("./mouse-move").default(e,o),s("./mouse-enter").default(e,o),s("./mouse-leave").default(e,o),s("./scroll").default(e,t),s("./value-change").default(e,o),s("./target").default(e,o),s("./canvas-change").default(e,o),s("./masked-element-size-change").default(e,o),s("./style-sheet-change").default(e,o)];return[s("./animation-start").default(e,o),s("./blur").default(e,o),s("./video-status-change").default(e,o),s("./click").default(e,o),s("./dom-change").default(e,t),s("./focus").default(e,o),s("./mouse-move").default(e,o),s("./mouse-enter").default(e,o),s("./mouse-leave").default(e,o),s("./scroll").default(e,t),s("./value-change").default(e,o),s("./window-resize").default(e,o),s("./target").default(e,o),s("./canvas-change").default(e,o),s("./masked-element-size-change").default(e,o),s("./style-sheet-change").default(e,o)]}},{"./animation-start":6,"./blur":7,"./canvas-change":8,"./click":9,"./dom-change":10,"./focus":11,"./masked-element-size-change":13,"./mouse-enter":14,"./mouse-leave":15,"./mouse-move":16,"./scroll":17,"./style-sheet-change":18,"./target":19,"./value-change":20,"./video-status-change":21,"./window-resize":22}],13:[function(e,t,o){!function(s){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(i,r){return{detect(e,t){const o=setInterval(()=>{try{this.checkUpdates(t)}catch(e){s("Error collecting masked elements changes (%o)",e),clearInterval(o)}},500);try{this.checkUpdates(t)}catch(e){s("Error collecting masked elements changes (%o)",e)}var n;e((n=o,function(){clearInterval(n)}))},checkUpdates(e){var t,o=void 0===this.elementSizes;o&&(this.elementSizes={});const n=i._getMaskedElementsSizes(r);if(!o)for(const s in n)n.hasOwnProperty(s)&&(t=n[s],this.elementSizes[s]!==t&&e({elementId:s,size:t}));this.elementSizes=n},encode(e){return{maskedElementSizeChange:e}}}}}.call(this,u("upscope:modules/browser-watcher-events/masked-element-size-change.js"))},{}],14:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(e,s){return{detect(e,t){var o,n=e=>{e.isUpscopeBrowserInstruction||t(e)};s.addEventListener("mouseover",n),e((o=n,function(){s.removeEventListener("mouseover",o)}))},encode(e){if(e.target&&!e.target.__upscopeMasked)return{mouseEnter:{elementId:n.elementId(e.target)}}}}};var n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};t=r(t);if(t&&t.has(e))return t.get(e);var o,n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e){var i;"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&((i=s?Object.getOwnPropertyDescriptor(e,o):null)&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=e[o])}n.default=e,t&&t.set(e,n);return n}(e("../../dom-utils"));function r(e){var t,o;return"function"!=typeof WeakMap?null:(t=new WeakMap,o=new WeakMap,(r=function(e){return e?o:t})(e))}},{"../../dom-utils":2}],15:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(e,s){return{detect(e,t){var o,n=e=>{e.isUpscopeBrowserInstruction||t(e)};s.addEventListener("mouseout",n),e((o=n,function(){s.removeEventListener("mouseout",o)}))},encode(e){var t=e.fromElement||e.target;if((!t||!t.__upscopeMasked)&&(!e.toElement||e.toElement.contentDocument))return{mouseLeave:{elementId:n.elementId(t)}}}}};var n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};t=r(t);if(t&&t.has(e))return t.get(e);var o,n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e){var i;"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&((i=s?Object.getOwnPropertyDescriptor(e,o):null)&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=e[o])}n.default=e,t&&t.set(e,n);return n}(e("../../dom-utils"));function r(e){var t,o;return"function"!=typeof WeakMap?null:(t=new WeakMap,o=new WeakMap,(r=function(e){return e?o:t})(e))}},{"../../dom-utils":2}],16:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(e,s){return{detect(e,t){var o,n=(0,i.throttle)(e=>{e.isUpscopeBrowserInstruction||t(e)},100);s.addEventListener("mousemove",n),s.addEventListener("mouseleave",n),e((o=n,function(){s.removeEventListener("mousemove",o),s.removeEventListener("mouseleave",o)}))},encode(e){if("mouseleave"===e.type&&!e.toElement&&!e.relatedTarget)return this.encodeLeave();const t={x:e.clientX,y:e.clientY,hoverElementId:null},o=s.elementFromPoint(e.clientX,e.clientY);return o&&!o.__upscopeMasked&&(t.hoverElementId=n.elementId(o)),{mouseMove:t}},encodeLeave(){return{mouseMove:{x:-1,y:-1}}}}};var i=e("../../utils.js"),n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};t=r(t);if(t&&t.has(e))return t.get(e);var o,n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e){var i;"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&((i=s?Object.getOwnPropertyDescriptor(e,o):null)&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=e[o])}n.default=e,t&&t.set(e,n);return n}(e("../../dom-utils.js"));function r(e){var t,o;return"function"!=typeof WeakMap?null:(t=new WeakMap,o=new WeakMap,(r=function(e){return e?o:t})(e))}},{"../../dom-utils.js":2,"../../utils.js":55}],17:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(e,i){return{detect(e,o){const n={};function t(e){var t=e.target===i.document?"document":a.elementId(e.target);void 0===n[t]&&(n[t]=(0,r.throttle)(e=>{o(e)},100)),n[t](e)}var s;i.document.addEventListener("scroll",t,!0),e((s=t,function(){i.document.removeEventListener("scroll",s,!0)}))},encode(e){let t;return e.target===i.document?t={x:a.windowScrollX(i),y:a.windowScrollY(i)}:e.target.__upscopeMasked||(t={elementId:a.elementId(e.target),x:e.target.scrollLeft,y:e.target.scrollTop}),{scroll:t}}}},o.scrollShadowRoot=function(i){return{detect(e,o){const n={};function t(e){var t=a.elementId(e.path[0]);void 0===n[t]&&(n[t]=(0,r.throttle)(e=>{o(e)},100)),n[t](e)}var s;i.addEventListener("scroll",t,!0),e((s=t,function(){i.removeEventListener("scroll",s,!0)}))},encode(e){let t;return{scroll:t=e.path[0].__upscopeMasked?t:{elementId:a.elementId(e.path[0]),x:e.path[0].scrollLeft,y:e.path[0].scrollTop}}}}};var r=e("../../utils"),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};t=c(t);if(t&&t.has(e))return t.get(e);var o,n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e){var i;"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&((i=s?Object.getOwnPropertyDescriptor(e,o):null)&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=e[o])}n.default=e,t&&t.set(e,n);return n}(e("../../dom-utils"));function c(e){var t,o;return"function"!=typeof WeakMap?null:(t=new WeakMap,o=new WeakMap,(c=function(e){return e?o:t})(e))}},{"../../dom-utils":2,"../../utils":55}],18:[function(e,t,o){!function(a){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(i,r){return{detect(e,t){const o=setInterval(()=>{try{this.checkUpdates(t)}catch(e){a("Error collecting style sheet changes (%o)",e),clearInterval(o)}},500);try{this.checkUpdates(t)}catch(e){a("Error collecting style sheet changes (%o)",e)}const n=this;var s;e((s=o,function(){clearInterval(s),delete n.styleSheetContents}))},checkUpdates(e){var t,o=void 0===this.styleSheetContents;o&&(this.styleSheetContents={});const n=i._getStyleSheetContents(r);if(!o)for(const s in n)n.hasOwnProperty(s)&&(t=n[s],this.styleSheetContents[s]!==t&&e({elementId:s,content:t}));this.styleSheetContents=n},encode(e){return{styleSheetChange:e}}}}}.call(this,u("upscope:modules/browser-watcher-events/style-sheet-change.js"))},{}],19:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(e,n){return{detect(e,t){var o,n=setInterval(()=>this.checkUpdates(t),500);e((o=n,function(){clearInterval(o)}))},checkUpdates(e){var t=void 0===this.lastTarget,o=!(o=0<location.hash.length?n.getElementById(location.hash.slice(1)):null)||o.__upscopeMasked?null:o.__upscopeID;o===this.lastTarget||t||e({elementId:o}),this.lastTarget=o},encode(e){return{targetChange:e}}}}},{}],20:[function(e,t,o){!function(a){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(i,r){return{detect(e,t){const o=setInterval(()=>{try{this.checkUpdates(t)}catch(e){a("Error collecting value changes (%o)",e),clearInterval(o)}},500);try{this.checkUpdates(t)}catch(e){a("Error collecting value changes (%o)",e)}const n=this;var s;e((s=o,function(){clearInterval(s),delete n.formValues}))},checkUpdates(e){var t,o=void 0===this.formValues;o&&(this.formValues={});const n=i._getFormValues(r);if(!o)for(const s in n)n.hasOwnProperty(s)&&(t=n[s],this.formValues[s]!==t&&e({elementId:s,value:t}));this.formValues=n},encode(e){return{valueChange:e}}}}}.call(this,u("upscope:modules/browser-watcher-events/value-change.js"))},{}],21:[function(e,t,o){!function(r){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(e,i){return{detect(e,t){i.addEventListener("play",t,!0),i.addEventListener("pause",t,!0),i.addEventListener("seeked",t,!0),i.addEventListener("ratechange",t,!0);const o=setInterval(()=>{try{for(const e of i.querySelectorAll("video"))t({target:e})}catch(e){r("Error collecting videos (%o)",e),clearInterval(o)}},5e3);try{for(const s of i.querySelectorAll("video"))t({target:s})}catch(e){r("Error collecting videos (%o)",e)}var n;e((n=t,function(){i.removeEventListener("play",n,!0),i.removeEventListener("pause",n,!0),i.removeEventListener("seeked",n,!0),i.removeEventListener("ratechange",n,!0),clearInterval(o)}))},encode(e){e=e.target;if(!(e.__upscopeMasked||e.dataset&&"yes"===e.dataset.upscopeProxyStream))return{videoStatusChange:{elementId:t.elementId(e),time:e.currentTime,playing:!e.paused,playbackRate:e.playbackRate}}}}};var t=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};t=a(t);if(t&&t.has(e))return t.get(e);var o,n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e){var i;"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&((i=s?Object.getOwnPropertyDescriptor(e,o):null)&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=e[o])}n.default=e,t&&t.set(e,n);return n}(e("../../dom-utils.js"));function a(e){var t,o;return"function"!=typeof WeakMap?null:(t=new WeakMap,o=new WeakMap,(a=function(e){return e?o:t})(e))}}.call(this,u("upscope:modules/browser-watcher-events/video-status-change.js"))},{"../../dom-utils.js":2}],22:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(e,t){return{detect(e,t){var o,t=(0,n.throttle)(t,1e3);window.addEventListener("resize",t),e((o=t,function(){window.removeEventListener("resize",o)}))},encode(e){return{windowResize:{w:window.innerWidth,h:window.innerHeight}}}}};var n=e("../../utils")},{"../../utils":55}],23:[function(t,e,o){!function(u){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var e,r=t("../utils.js"),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};t=a(t);if(t&&t.has(e))return t.get(e);var o,n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e){var i;"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&((i=s?Object.getOwnPropertyDescriptor(e,o):null)&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=e[o])}n.default=e,t&&t.set(e,n);return n}(t("../dom-utils.js")),i=(e=t("./browser-watcher-events/index.js"))&&e.__esModule?e:{default:e},n=t("./browser-watcher-events/scroll.js"),p=t("./assets-utils.js");function a(e){var t,o;return"function"!=typeof WeakMap?null:(t=new WeakMap,o=new WeakMap,(a=function(e){return e?o:t})(e))}o.default=class{constructor(e,t,o=!1){this.active=!1,this.sendEvent=e,this.killers=[],this.assetsCache={},this.sentAssets=[],this.upscopeId=0,this.consoleHandler=t,this.isChildFrame=o,y("trackConsole")&&!y("fromProxy")&&t&&this.consoleHandler.init()}async activate(e){u("Activating browser watcher"),this.active=!0,await this.awaitDocumentLoaded(window.document),this._ensureHasIds(null,document,e),this.activateInterval=this.activateInterval||setInterval(()=>this._activateForWindow(window,Boolean(e),e),2e3),this._activateForWindow(window,Boolean(e),e)}async _activateForWindow(e=window,t=!1,o=null){if(await this.awaitDocumentLoaded(e.document),this.active){const n=t?o:"root";if(null!==n){if(!e.document.__upscopeTrackingActive){u("Activating events watchers for window %O",n);for(const s of(0,i.default)(this,e,e.document,t))s.detect(e=>{this.killers.push(e)},async e=>{e=await s.encode(e);"object"==typeof e&&this.sendEvent(n,e)})}d.doForShadowRoots(e.document,e=>this._activateForShadowRoot(n,e)),d.doForIframes(e.document,e=>{e.__upscopeID&&(e.__upscopeFrameActive=!0,this._activateForWindow(e.contentWindow,!0,e.__upscopeID))},(e,t)=>{e.__upscopeID&&(e.__upscopeFrameActive=!0,t.activate(this.sendEvent,e.__upscopeID))}),e.document.__upscopeTrackingActive||e!==window&&!e.parent.document.__upscopeTrackingActive?e.document.__upscopeTrackingActive=!0:(e.document.__upscopeTrackingActive=!0,this.sendEvent(n,{pageLoad:await this.getSnapshot(e)}))}}}_deactivateForWindow(e=window){e.document.__upscopeTrackingActive=!1,d.doForIframes(e.document,e=>{e.__upscopeFrameActive=!1,this._deactivateForWindow(e.contentWindow)},(e,t)=>{e.__upscopeFrameActive=!1,t.deactivate()},!0),d.doForShadowRoots(e.document,e=>{e.__upscopeTrackingActive=!1})}deactivate(){u("Deactivating events watchers"),clearInterval(this.activateInterval),this.activateInterval=null,this.active=!1,this._removeIds();for(const e of this.killers)try{e()}catch(e){u("Failed to kill listener (%o)",e)}this.killers=[],this._deactivateForWindow()}async awaitDocumentLoaded(e){const o=()=>"complete"===e.readyState||"interactive"===e.readyState;o()||await new Promise(e=>{const t=setInterval(()=>{o()&&(clearInterval(t),e())},100)})}async getSnapshot(n=window,e=!1){await(0,r.until)(()=>Boolean(n.document.documentElement)),this._ensureHasIds();const t={version:y("version")};let o;n===window&&(this.sentAssets=[],o=this.collectNewAssets(n.document,e));var s,i=n.document["doctype"],i=(t.doctype=i?"<!DOCTYPE "+i.name+(i.publicId?' PUBLIC "'+i.publicId+'"':"")+(!i.publicId&&i.systemId?" SYSTEM":"")+(i.systemId?' "'+i.systemId+'"':"")+">":null,t.url=n.location.href,n.document.querySelectorAll("base")),i=(t.baseUrl=(0===i.length?n.location:i[0]).href,t.styleSheetsCount=n.document.styleSheets.length,t.windowSize={w:n.innerWidth,h:n.innerHeight},t.formValues=this._getFormValues(n.document),this.encodeNode(n.document.documentElement).then(e=>{t.html=e}));t.scrollPositions=this._getScrollPositions(n),t.scrollbarWidth=this._getScrollbarWidth(n.document),t.targetElementId=(s=0<location.hash.length?n.document.getElementById(location.hash.slice(1)):null)?s.__upscopeID:null,t.focusElementId=n.document.activeElement&&"BODY"!==n.document.activeElement.tagName?n.document.activeElement.__upscopeID:null,t.console=this.consoleHandler&&this.consoleHandler.console,t.canvases=this._getCanvasUrls(n.document,e?1:0),t.maskedElementsSizes=this._getMaskedElementsSizes(n.document),t.styleSheetContents=this._getStyleSheetContents(n.document),t.animations=(()=>{if(!n.document.getAnimations)return[];const e=[];for(const o of n.document.getAnimations()){var t;"[object Animation]"===Object.prototype.toString.apply(o)&&(o.__upscopeEventSent=!0,(t=d.elementId(o.effect.target))&&e.push({elementId:t,...d.encodeAnimation(o)}))}return e})(),this.active||n!==window||this._removeIds();try{o&&(t.assets=await o)}catch(e){u("Could not collect assets %o",e),t.assets={}}return await i,t}async collectNewAssets(e,t=!1){const n={},s=[],i=document.createElement("a"),o=new Date;let r;s.push(...[...e.styleSheets].map(e=>[e.href,e,!1]),...[...e.images].map(e=>[e.src,e,!1]),...[...e.querySelectorAll("use")].map(e=>[e.getAttribute("xlink:href")||("string"==typeof e.href?e.href:null),null,!0]),...Object.values(this._getStyleSheetContents(e)).flatMap(e=>d.findAllUrlsInCss(e)).map(e=>[e,null,!1]));do{if(Date.now()-o>(t?1e3:6e3)){u("Stopped collecting assets as it's been longer than 6 seconds");break}const a=[];for(let[t,e,o]of s)t&&(i.href=t,(t=i.href.split("#")[0])===location.href.split("#")[0]||this.sentAssets.includes(t)||!o&&!this._shouldProxyAsset(t)||t.startsWith("data:")||(this.assetsCache[t]?n[t]=this.assetsCache[t]:a.push((0,p.collectAsset)(t,e).then(e=>[t,e])),this.sentAssets.push(t)));r=await Promise.all(a),s.length=0;for(const[c,l]of r)void 0!==l&&(n[c]=l,this.assetsCache[c]=l),window.URL&&l&&l.startsWith("text/css")&&s.push(...d.findAllUrlsInCss(window.atob(l.slice(l.indexOf(":")+1))).map(e=>[new URL(e,c).href,null,!1]))}while(0<r.length);return n}_shouldProxyAsset(e){if(!(2e3<e.length)){if(e.startsWith("blob:"))return!0;if(e.startsWith("chrome-extension:"))return!0;if(e.startsWith("http://")||e.startsWith("https://"))for(const t of y("proxyAssets"))if((0,r.matchesPattern)(t,e))return!0}return!1}async encodeNode(s){if("ELEMENT_NODE"!==d.NODE_TYPES[s.nodeType])return"TEXT_NODE"===d.NODE_TYPES[s.nodeType]?{text:s.textContent}:"DOCUMENT_FRAGMENT_NODE"===d.NODE_TYPES[s.nodeType]?{shadowRoot:!0,c:await(async()=>{const e=[],t=[];for(const o of s.childNodes)t.push(this.encodeNode(o));for(const n of await Promise.all(t))null!==n&&"SCRIPT"!==s.tagName&&e.push(n);return s.shadowRoot&&e.push(await this.encodeNode(s.shadowRoot)),e})(),ss:(t=>{if(t){let e="";for(const o of t)e+=(0,p.getStylesheetContent)(o);return e}})(s.adoptedStyleSheets)}:null;{const e={tag:s.tagName+"#"+s.__upscopeID};return s.__upscopeMasked&&(e.masked=!0),s.__upscopeNoRemoteControl&&(e.rc=!1),"http://www.w3.org/2000/svg"===s.namespaceURI&&(e.svg=1),0<s.attributes.length&&(e.a=(()=>{const e={};for(const t of s.attributes)e[t.name]=t.value,s.__upscopeMasked&&"value"===t.name&&(e[t.name]=t.value.replace(/./g,"*"));return e})()),(0<s.childNodes.length||s.shadowRoot)&&!s.__upscopeMasked&&(e.c=await(async()=>{const e=[],t=[];for(const o of s.childNodes)t.push(this.encodeNode(o));for(const n of await Promise.all(t))null!==n&&"SCRIPT"!==s.tagName&&e.push(n);return s.shadowRoot&&e.push(await this.encodeNode(s.shadowRoot)),e})()),["IFRAME","FRAME"].includes(s.tagName)&&(d.isVisible(s)||s.__upscopeFrameActive)&&(s.__upscopeChildFrameHandler?e.iframe=await s.__upscopeChildFrameHandler.getSnapshot(s.__upscopeID):void 0!==s.contentWindow&&d.checkIframeAccess(s)&&(e.iframe=await this.getSnapshot(s.contentWindow))),"IMG"===s.tagName&&(e.isLoaded=Boolean(s.complete)),e}}_getScrollPositions(e){return{window:{x:d.windowScrollX(e),y:d.windowScrollY(e)},elements:this._getRootScrollPositions(e.document)}}_getRootScrollPositions(e){const t=d.getAllElements(e),o={};for(const n of t)n.parentNode&&n.parentNode.__upscopeMasked||"HTML"!==n.tagName&&(n.shadowRoot&&Object.assign(o,this._getRootScrollPositions(n.shadowRoot)),0===n.scrollLeft&&0===n.scrollTop||(o[n.__upscopeID]={x:n.scrollLeft,y:n.scrollTop}));return o}_activateForShadowRoot(t,e){if(!e.__upscopeTrackingActive){e.__upscopeTrackingActive=!0;const o=(0,n.scrollShadowRoot)(e);o.detect(e=>{this.killers.push(e)},async e=>{e=await o.encode(e);"object"==typeof e&&this.sendEvent(t,e)})}}_getFormValues(e){const o={},t=e.querySelectorAll("input,textarea,select");for(const n of t)if(n.__upscopeID&&"file"!==n.type&&!n.parentNode.__upscopeMasked){let e,t;"SELECT"===n.tagName?(e="selectedIndex",t=n.selectedIndex):"checkbox"===n.type||"radio"===n.type?(e="checked",t=n.checked?1:0):(e="value",t=n.value,n.__upscopeMasked&&(t=t.replace(/./g,"*"))),o[n.__upscopeID]=e+":"+t}return o}_getStyleSheetContents(e,t=!1){const o={},n=e.styleSheets;if(this.styleSheetContents=this.styleSheetContents||{},this.styleSheetContents[e.__upscopeRootId||"root"]=this.styleSheetContents[e.__upscopeRootId||"root"]||{},this.styleSheetContents[e.__upscopeRootId||"root"][t?1:0])return this.styleSheetContents[e.__upscopeRootId||"root"][t?1:0];var s=Date.now();for(const i of n){const r=i.ownerNode;try{r&&r.__upscopeID&&!r.__upscopeError&&(t||y("styleSheetContentFromRules")(r))&&(o[r.__upscopeID]=(0,p.getStylesheetContent)(i))}catch(e){r.__upscopeError=!0,u("Could not retrieve content from stylesheet (%o)",e)}}s=Date.now()-s;return 100<s&&(this.styleSheetContents[e.__upscopeRootId||"root"][t?1:0]=o,setTimeout(()=>delete this.styleSheetContents[e.__upscopeRootId||"root"][t?1:0],7*s)),o}_getScrollbarWidth(e){const t=e.createElement("div");if(t.style.width="100px",t.style.height="100px",t.style.overflow="scroll",t.style.position="absolute",t.style.top="-9999px",!e.body)return 0;e.body.append(t);e=t.offsetWidth-t.clientWidth;return t.remove(),e}_getCanvasUrls(t,o=0){if(!y("enableCanvases"))return{};0===o&&this.canvasCompressionOn&&(o=.5),this.canvasContents=this.canvasContents||{},this.canvasContents[t.__upscopeRootId||"root"]=this.canvasContents[t.__upscopeRootId||"root"]||{},this.canvasContents[t.__upscopeRootId||"root"][o]=this.canvasContents[t.__upscopeRootId||"root"][o]||{};const e=Date.now(),n={},s=[];this.canvasErrors=this.canvasErrors||[];for(const r of t.querySelectorAll("canvas,video"))if(r.__upscopeID&&d.isVisible(r)&&("CANVAS"===r.tagName||"yes"===r.dataset.upscopeProxyStream)&&!this.canvasErrors.includes(r.__upscopeID)&&d.isVisible(r))try{this.canvasContents[t.__upscopeRootId||"root"][o][r.__upscopeID]||(s.push(r.__upscopeID),this.canvasContents[t.__upscopeRootId||"root"][o][r.__upscopeID]=(0,p.getDataUrl)(r,o)),n[r.__upscopeID]=this.canvasContents[t.__upscopeRootId||"root"][o][r.__upscopeID]}catch(e){this.canvasErrors.push(r.__upscopeID),u("Ignoring canvas %o due to error %o",r,e)}var i=Date.now()-e;return setTimeout(()=>{for(const e of s)delete this.canvasContents[t.__upscopeRootId||"root"][o][e]},7*Math.min(i,1e3)),800<i&&(this.canvasCompressionOn||u("Turning canvas compression on"),this.canvasCompressionOn=!0,clearTimeout(this.canvasCompressionOffTimeout),this.canvasCompressionOffTimeout=setTimeout(()=>{this.canvasCompressionOn=!1},1e4)),n}_getMaskedElementsSizes(e){const t={};for(const o of d.getAllElements(e))!o.__upscopeID||o.parentNode.__upscopeMasked||o.__upscopeMasked&&(t[o.__upscopeID]=[o.offsetWidth,o.offsetHeight].join("x"));return t}_ensureHasIds(t=null,e=document,o=null,n){o&&(e.__upscopeRootId=o);for(const s of d.getAllElements(e))void 0===s.__upscopeID&&(n&&n(s),s.__upscopeID=(o?o+">":"")+(t?t+"-":"")+String(this.upscopeId++),s.__upscopeMutationBatch=t,y("maskElementMiddleware")(s)&&(s.__upscopeMasked=!0),(this.isChildFrame||s.__upscopeMasked||s.__upscopeDialogButton||!y("allowRemoteMiddleware")(s))&&(s.__upscopeNoRemoteControl=!0)),"upscope___overlay"!==s.id&&void 0!==s.style&&"string"==typeof s.style.zIndex&&0<s.style.zIndex.length&&2147483645<Number.parseInt(s.style.zIndex,10)&&(s.style.zIndex="2147483645"),s.shadowRoot&&this._ensureHasIds(t,s.shadowRoot,s.__upscopeID,n);d.doForIframes(e,e=>this._ensureHasIds(t,e.contentDocument,e.__upscopeID,n))}_removeIdsFromElement(e,t=!1){if(void 0!==e.__upscopeID&&(delete e.__upscopeID,void 0!==e.__upscopeMasked&&delete e.__upscopeMasked,void 0!==e.__upscopeMutationBatch&&delete e.__upscopeMutationBatch,void 0!==e.__upscopeNoRemoteControl&&delete e.__upscopeNoRemoteControl,void 0!==e.__upscopeScrollable&&delete e.__upscopeScrollable,e.shadowRoot&&this._removeIds(e.shadowRoot),t))for(const o of d.getAllElements(e))this._removeIdsFromElement(o,!1)}_removeIds(e=document){u("Removing all elements IDs for document (%o)",e),void 0!==e.__upscopeRootId&&delete e.__upscopeRootId;for(const t of d.getAllElements(e))this._removeIdsFromElement(t);d.doForIframes(e,e=>this._removeIds(e.contentDocument),null,!0),this.upscopeId=0}}}.call(this,u("upscope:modules/browser-watcher.js"))},{"../dom-utils.js":2,"../utils.js":55,"./assets-utils.js":3,"./browser-watcher-events/index.js":12,"./browser-watcher-events/scroll.js":17}],24:[function(v,e,w){!function(r){"use strict";Object.defineProperty(w,"__esModule",{value:!0}),w.default=void 0;var n=v("../utils.js"),s=v("../dom-utils.js"),i=m(v("./storage.js")),t=v("./dialogs.js"),e=m(v("./browser-watcher.js")),o=m(v("./browser-instructions.js")),a=m(v("./terminate-button-controller.js")),c=m(v("./request-agent-button-controller.js")),l=m(v("./lookup-code-controller.js")),u=m(v("./integration.js")),d=m(v("./console-handler.js")),p=m(v("./phone-controller.js")),h=m(v("./history-collector.js")),f=m(v("./link-proxy-rewrite.js")),g=m(v("./browser-support.js")),_=m(v("./fingerprint.js"));function m(e){return e&&e.__esModule?e:{default:e}}w.default=class{constructor(){r("Setting up Upscope connection manager"),this.ws=null,this.socketReady=!1,this.waitBeforeReconnect=0,this.socketAttemptingReconnect=!1,this.brokenConnectionTimeout=null,this.socketConnected=!1,this.socketConnecting=!1,this.closedSocketAfterInactivity=!1,this.doNotReconnect=!1,this.doNotDisconnect=!1,this.shortId=null,this.uniqueConnectionId=null,this.connectionActiveSince=null,this.sessionStatus=null,this.eventId=0,this.socketShouldBeOpen=!1,this.pageLoadId=(0,n.uuid)(),this.lookupCode=null,this.listeners={},this.currentUrl=b().href,this.agentsAvailable=!1,this.connectionHasJustBeenReset=!1,this.consoleHandler=new d.default(e=>{"active"===this.sessionStatus&&this.sendBrowserEvent("root",{console:e})}),this.phoneController=new p.default,this.browserWatcher=new e.default((e,t)=>this.sendBrowserEvent(e,t),this.consoleHandler),this.browserInstructionsReceiver=new o.default(this,this.consoleHandler),this.integration=new u.default(this),this.linkProxyRewrite=new f.default(this),this.integration.init(),this._checkQueryString(),this._checkNamedCall(),new l.default(this),(y("showUpscopeLink")||y("showTerminateButton"))&&new a.default(this),"never"!==y("showAgentRequestButton")&&new c.default(this),y("collectHistory")&&(this.historyCollector=new h.default(this,this.browserWatcher)),this._initialConnect()}async _initialConnect(){if(await this._setRegion(),y("autoconnect")||await this._hasRecentlyConnected()||this._isPriority())this._connect(this._isPriority());else{const e=setInterval(async()=>{(this.socketConnecting||this.socketConnected||this.doNotReconnect)&&clearInterval(e),(await this._hasRecentlyConnected()||this._isPriority()||window.Upscope.q.some(e=>["connect","getWatchLink","getLookupCode","getUserId","getShortId","requestAgent"].includes(e[0])))&&(this._connect(!0),clearInterval(e))},1e3)}}async _setRegion(){var e=y("region")||await i.default.get("region")||window.Upscope.__defaultRegion;e&&(y("dataEndpoint",(0,n.baseEndpoint)("data--"+e,3005,"ws")+"/session"),y("pageviewsEndpoint",(0,n.baseEndpoint)("data-collection--"+e,3005)+"/pageviews"),y("region",e),i.default.set("region",e))}async _getSavedIds(){var e;r("Finding saved IDs"),this.uniqueConnectionId=sessionStorage.getItem("__upscope:uniqueConnectionId"),this.connectionActiveSince=sessionStorage.getItem("__upscope:connectionActiveSince"),null===this.connectionActiveSince&&(this.connectionActiveSince=new Date,sessionStorage.setItem("__upscope:connectionActiveSince",this.connectionActiveSince)),this.shortId=await i.default.get("shortId"),this.lookupCode=await i.default.get("lookupCode"),!this.shortId&&this.shortIdFromQueryString&&(this.shortId=this.shortIdFromQueryString,i.default.set("shortId",this.shortId)),this.lookupCode&&(!(e=await i.default.get("lookupCodeSetAt"))||36e5<Date.now()-new Date(e))&&(this.lookupCode=null),r("Found IDs: shortID (%s), uniqueConnectionId (%s), lookupCode (%s)",this.shortId,this.uniqueConnectionId,this.lookupCode)}async encodeConnectionInfo(){var e=this.integration?this.integration.integrationUserIdentities:void 0,t=this.integration?this.integration.integrationUserUniqueId:void 0;let o=null;try{y("useFingerprinting")&&(o=await(0,n.timeout)((0,_.default)(),1e3))}catch(e){r("Error with fingerprinting browser %o",e)}return{activeSince:this.connectionActiveSince,agentPrompt:y("agentPrompt"),allowAgentRedirect:y("allowAgentRedirect"),allowRemoteClick:y("allowRemoteClick"),allowRemoteConsole:y("allowRemoteConsole"),allowRemoteScroll:y("allowRemoteScroll"),allowRemoteType:y("allowRemoteType"),apiKey:y("apiKey"),audioSupported:(0,g.default)("audio"),callName:y("callName"),currentUrl:b().href,fingerprint:o,hasFocus:"visible"===document.visibilityState,identities:void 0===y("identities")?e:y("identities"),integration:y("integrateWithLivechat")?this.integration.integrationId:null,integrationIds:y("integrationIds"),jsConfiguration:y("jsConfiguration"),lookupCode:this.lookupCode,proxied:!0===y("fromProxy"),requireAuthorizationForSession:y("requireAuthorizationForSession"),reset:this.connectionHasJustBeenReset,shortId:this.shortId,tags:y("tags"),timestamp:"function"==typeof Date.now?Date.now():null,uniqueConnectionId:this.uniqueConnectionId,uniqueId:void 0===y("uniqueId")?t:y("uniqueId"),version:y("version")}}_handleSocketMessage(e){var{c:t,d:o}=JSON.parse(e.data);switch("ping"!==t&&r("Received instruction %s with data %O",t,o),t){case"ping":return this._receivedPing(),void this._emit("pong");case"youAre":return(async()=>{var[e,t]=o;this.shortId!==e&&i.default.set("shortId",e),this.uniqueConnectionId!==t&&sessionStorage.setItem("__upscope:uniqueConnectionId",t),this.uniqueConnectionId=t,this.shortId=e,this.connectionReady()})();case"apiKeyError":case"dataError":var[n,s]=o;return void k(n,s);case"welcomeBack":this.connectionReady();break;case"doNotReconnect":this.doNotReconnect=!0;break;case"doNotDisconnect":this.doNotDisconnect=!0;break;case"youCanDisconnect":this.doNotDisconnect=!1;break;case"beginSession":return this.handleBeginSession(o);case"continueSession":return this.handleContinueSession(o);case"sessionUpdate":return this.handleSessionUpdate(o);case"endSession":return this.handleEndSession(o);case"browserInstruction":return this.handleBrowserInstruction(o);case"newObserver":return this._trigger("newObserver",o);case"observerGone":return this._trigger("observerGone",o),this.browserInstructionsReceiver.observerGone(o);case"callStart":return this.handleCallStart(o);case"callEnd":return this.handleCallEnd();case"callAccepted":return this.handleCallAccepted();case"agentsAvailable":return this.agentsAvailable=!0,this._trigger("agentsAvailable"),void r("Agents are available");case"requestStatus":return this.handleRequestStatusChange(o);case"sessionRatingToken":this.sessionRatingInfo=o;break;case"proxyToken":this.proxyToken=o.token;break;case"closeRatingScreen":k("info","Closing rating screen");break;default:return k("error","Unrecognized connection message",t)}}async _connect(e=!0){if(!(this.doNotReconnect||this.socketConnecting||this.socketConnected)){if(this.socketConnecting=!0,window.Upscope.q.some(e=>"reset"===e[0])?(r('A "reset" command is waiting in the Queue during connection. Resetting ids'),window.Upscope.q=window.Upscope.q.filter(e=>"reset"!==e[0]),await this.resetIdentities()):await this._getSavedIds(),window.Upscope.q.some(e=>"updateConnection"===e[0])){r('Some "updateConnection" command is waiting in the Queue during connection. Updating connection details before we connect.');var t=window.Upscope.q.filter(e=>"updateConnection"===e[0]).map(e=>e[1]);window.Upscope.q=window.Upscope.q.filter(e=>"updateConnection"!==e[0]);for(const o of t)this.updateConnection(o)}if(e&&i.default.set("lastConnectedAt",new Date),!(0,g.default)("all"))return this.socketConnecting=!1,this._reportUnsupportedBrowser();r("Setting up websocket connection"),this.socketShouldBeOpen=!0,this.ws=new WebSocket(y("dataEndpoint")+"?apiKey="+y("apiKey")+"&version="+y("version")+(this._isPriority()?"&priority=1":"")),this.ws.addEventListener("open",async()=>{r("Websocket connection opened"),this.socketConnecting=!1,this.socketConnected=!0,this.waitBeforeReconnect=0,this.socketAttemptingReconnect=!1,this.closedSocketAfterInactivity=!1,this._emit("hello",await this.encodeConnectionInfo()),this._receivedPing()}),this.ws.addEventListener("close",()=>{r("Websocket connection closed"),this.socketConnected&&(r("Will end session in 10 seconds after web socket connection closed"),this.startedSessionAfterDisconnect=!1,setTimeout(()=>{if(this.socketConnected&&this.startedSessionAfterDisconnect)return r("Socket connected again, will not be ending session");this.handleEndSession()},2e4)),this.socketConnected=!1,this.socketConnecting=!1,this.socketReady=!1,this.socketAttemptingReconnect=!1,!this.closedSocketAfterInactivity&&this.socketShouldBeOpen&&this._reconnect()}),this.ws.addEventListener("error",()=>{r("Websocket connection error")}),this.ws.addEventListener("message",this._handleSocketMessage.bind(this)),this._manageIdleDisconnect()}}async _reportUnsupportedBrowser(){const t=new XMLHttpRequest;t.open("POST",(0,n.baseEndpoint)("data",3005)+"/unsupported-user/"),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.send(JSON.stringify({user:await this.encodeConnectionInfo()})),t.addEventListener("load",()=>{if(299<t.status)return k("error","Problem reporting unsupported browser",t.status,t.response);var e=JSON.parse(t.response)["shortId"];this.shortId=e,i.default.set("shortId",e),this.integration.live(this.getWatchLink())})}async _reportPageviews(n){return new Promise((e,t)=>{const o=new XMLHttpRequest;o.open("POST",y("pageviewsEndpoint")),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.send(JSON.stringify({user:{apiKey:y("apiKey"),shortId:this.shortId},pageviews:n})),o.addEventListener("load",()=>{299<o.status&&(r("Pageview reporting returned code %d (%o)",o.status,o.response),t(new Error("Problem reporting pageviews"))),200===o.status&&e()})})}_receivedPing(){this.connected&&(this.brokenConnectionTimeout&&(this.brokenConnectionTimeout=clearInterval(this.brokenConnectionTimeout)),this.brokenConnectionTimeout=setTimeout(()=>{r("Disconnecting because the server has not sent a ping for too long"),this.ws.close()},6e4))}_reconnect(){this.waitBeforeReconnect+=1e3,this.socketAttemptingReconnect=!0;var e=Math.floor(15*Math.random())-10,e=this._isPriority()?500:this.waitBeforeReconnect*(0<e?e:1);this.reconnectTimeout||this.socketConnecting||this.socketConnected||this.doNotReconnect||(r("Waiting %d seconds before reconnecting",Number.parseInt(e/1e3,10)),this.reconnectTimeout=setTimeout(()=>{this._connect(!1),this.reconnectTimeout=null},e))}_isPriority(){return sessionStorage.getItem("__upscope:everActive")||sessionStorage.getItem("__upscope:integrationOpened")||sessionStorage.getItem("__upscope:lookupCodeClick")||sessionStorage.getItem("__upscope:namedCall")||y("fromProxy")}async _hasRecentlyConnected(){var e=await i.default.get("lastConnectedAt");return!!e&&Date.now()-new Date(e)<864e5}_checkQueryString(){if(location.search.includes("__upscope_")){var t=location.search.includes("__upscope_call_for=")&&location.search.split(/[?|&]__upscope_call_for=/).pop().split("&").shift()||void 0,t=(t&&y("callName",t),location.search.includes("__upscope_unique_id=")&&location.search.split(/[?|&]__upscope_unique_id=/).pop().split("&").shift()||void 0),t=(t&&y("uniqueId",t),location.search.includes("__upscope_short_id=")&&location.search.split(/[?|&]__upscope_short_id=/).pop().split("&").shift()||void 0);t&&(this.shortIdFromQueryString=t);let e=location.search.replace(/[&?]__upscope_[A-z_]+=[^&]+/g,"");e.startsWith("&")&&(e="?"+e.slice(1)),window.history&&window.history.replaceState(null,null,location.origin+location.pathname+e)}}async _checkNamedCall(){var e;!y("callName")||(e=await i.default.get("waitingForCallAt"))&&Date.now()-new Date(e)<864e5||(i.default.set("waitingForCallAt",new Date),this._trigger("waitingForCall"),sessionStorage.setItem("__upscope:namedCall",!0))}connectionReady(){this.socketReady=!0,this.connectionHasJustBeenReset=!1,this.processQueue(),this.instrumentQueuePush(),this._watchUrlChanges(),this._reportIdleness(),this.browserInstructionsReceiver.init(),this.integration.live(this.getWatchLink()),this._trigger("connection")}instrumentQueuePush(){if(!this.instrumentedQueuePush){this.instrumentedQueuePush=!0;const t=window.Upscope.q.push;window.Upscope.q.push=(...e)=>{t.call(window.Upscope.q,...e),this.processQueue()}}}_watchUrlChanges(){this.urlChangesInterval=this.urlChangesInterval||setInterval(()=>{this.currentUrl!==b().href&&(this.currentUrl=b().href,r("Detected url changed to %s",this.currentUrl),this._emit("connectionUpdate",{currentUrl:this.currentUrl}))},1e3)}async handleBeginSession(t){let e=this.startedSessionAfterDisconnect=!0;sessionStorage.setItem("__upscope:everActive",!0),r("Starting screen share"),y("requireAuthorizationForSession")&&(r("Will request authorization from user for screen share"),this._emit("sessionStatusUpdate","pendingRequest"),this.sessionStatus="pendingRequest",e=await new Promise(e=>{y("onSessionRequest")(e,t.requestingAgent),this._trigger("sessionRequest")})),setTimeout(()=>{if("active"===this.sessionStatus)return this._emit("sessionStatusUpdate","active");e?(r("User approved request or no approval was needed. Screen share begins now"),this._emit("sessionStatusUpdate","active"),this.sessionStatus="active",this.browserWatcher.activate(),this._trigger("sessionStart")):(r("User did not approve screen share. Terminating session now."),this._emit("stopSession"))},50)}async handleCallStart(e){r("Received phone call request"),this.callToken=e,this._trigger("callStart");e=await new Promise(e=>{"function"==typeof y("customCallController")?y("customCallController")(e):this.phoneController.show(e)});r("Phone call "+(e?"authorized":"refused")),e?this.acceptCall():this.endCall()}acceptCall(){this._emit("acceptCall"),window.open(`${y("phoneEndpoint")}?region=${y("region")}&token=`+this.callToken,"upscope-phone","toolbar=no,top=0,left=0,width=400,height=200")}endCall(){this._emit("endCall")}handleCallAccepted(){this.phoneController.hide(),this._trigger("callAccepted")}handleRequestStatusChange(e){r("Agent request is now %s",e),this._trigger("agentRequestUpdate",e)}requestAgent(){r("Requesting agent"),this._emit("requestAgent")}cancelRequestAgent(){r("Canceling agent request"),this._emit("cancelRequestAgent")}handleCallEnd(){this.phoneController.hide(),this._trigger("callEnd")}async getLookupCode(){if(await this._connect(!0),!this.lookupCode){let t="";for(let e=0;e<4;e++)t+=String(Math.floor(10*Math.random()));this.lookupCode=t,this.socketConnected&&this._emit("connectionUpdate",{lookupCode:this.lookupCode})}return i.default.set("lookupCodeSetAt",new Date),i.default.set("lookupCode",this.lookupCode),this.lookupCode}async handleContinueSession(){if(sessionStorage.setItem("__upscope:everActive",!0),this.startedSessionAfterDisconnect=!0,"active"===this.sessionStatus)return this.sendSnapshot();this.sessionStatus="active",this.browserWatcher.activate(),this._trigger("sessionContinue")}handleSessionUpdate(e){"active"!==this.sessionStatus&&(this.sessionStatus=e.status,"active"===e.status&&((0,t.clearDialogs)(),this.sessionStatus="active",this.browserWatcher.activate(),this._trigger("sessionStart")))}handleEndSession(){null!==this.sessionStatus&&(0,t.clearDialogs)(),"active"===this.sessionStatus&&(r("Ending session"),this.browserWatcher.deactivate(),this.browserInstructionsReceiver.hideAll(),this._trigger("sessionEnd")),this.phoneController.hide(),this.sessionStatus=null,i.default.del("waitingForCallAt")}async stopSession(){r("Stopping session"),await this._emit("stopSession"),this.handleEndSession()}handleBrowserInstruction(e){"active"===this.sessionStatus&&this.browserInstructionsReceiver.receiveInstruction(e)}async sendSnapshot(){var e=await this.browserWatcher.getSnapshot();this.sendBrowserEvent("root",{snapShot:e})}_dataBounce(e){this.sendBrowserEvent("root",{dataBounce:e})}sendBrowserEvent(e,t){void 0===t.console&&this.eventId<100&&r("Sending browser event for iframe %s: %s (%o)",e,Object.keys(t)[0],t),t.ts=Date.now(),this._emit("browserEvent",[this.pageLoadId+":"+this.eventId++,e,t])}updateConnection(e){e.identities&&["list of identities here","undefined","null"].includes("function"==typeof e.identities.join?e.identities.join(" "):e.identities)&&delete e.identities,e.uniqueId&&["USER UNIQUE ID","undefined","null"].includes(e.uniqueId)&&delete e.uniqueId,e.tags&&"#list #of #tags #here"===("function"==typeof e.tags.join?e.tags.join(" "):e.tags)&&delete e.tags;for(const t of["identities","uniqueId","tags","integrationIds","callName","agentPrompt","allowRemoteConsole","allowRemoteClick","allowRemoteScroll","allowRemoteType","allowAgentRedirect"])void 0!==e[t]&&y(t,e[t]);this.socketConnecting||((0,g.default)("all")?this._emit("connectionUpdate",e):this._reportUnsupportedBrowser(),this._checkNamedCall())}getWatchLink(){return((0,n.isProduction)()?"https://upscope.io/w/":(0,n.baseEndpoint)("app",3e3)+"/w/")+this.shortId}_reportIdleness(){if(!this.idlenessReporterActive){let e,t=!0;setInterval(()=>{t&&"visible"!==document.visibilityState?(t=!1,e=setTimeout(()=>{"visible"!==document.visibilityState&&(r("Detected page now idle"),this._emit("connectionUpdate",{status:"idle"}))},5e3)):t||"visible"!==document.visibilityState||(r("Detected page now active"),this._emit("connectionUpdate",{status:"active"}),t=!0,clearInterval(e))},1e3),window.addEventListener("focus",()=>{this.socketReady&&(r("Detected focus on page"),this._emit("focus"))}),this.idlenessReporterActive=!0}}_touchLastActivityAt(){this.lastActivityAt=new Date}_manageIdleDisconnect(){if(y("disconnectAfterSeconds")&&!(y("disconnectAfterSeconds")<1)&&!this.idleDisconnectManagerActive){this.idleDisconnectManagerActive=!0,this.lastActivityAt=new Date;const o=e=>{e.__upscopeIdleManagerActive||(r("Adding event listeners to check for page activeness"),e.document.addEventListener("mousemove",this._touchLastActivityAt.bind(this),!0),e.document.addEventListener("scroll",this._touchLastActivityAt.bind(this),!0),e.document.addEventListener("keydown",this._touchLastActivityAt.bind(this),!0),e.__upscopeIdleManagerActive=!0),(0,s.doForIframes)(e.document,e=>o(e.contentWindow))};let t=new Date;o(window),setInterval(()=>{var e=(Date.now()-this.lastActivityAt)/1e3<20?10:60;(Date.now()-t)/1e3<e||(o(window),t=new Date)},1e3),setInterval(()=>{var e;this.socketShouldBeOpen&&((e=(Date.now()-this.lastActivityAt)/1e3<y("disconnectAfterSeconds"))&&!1===this.socketConnected&&!1===this.socketConnecting&&!1===this.doNotReconnect&&!1===this.socketAttemptingReconnect?(this._connect(!1),r("Reconnecting to server after activity")):e||!0!==this.socketConnected||null!==this.sessionStatus||!1!==this.doNotDisconnect||(this.closedSocketAfterInactivity=!0,this.ws.close(),r("Disconnecting from server due to inactivity")))},1e3)}}async _emit(e,t){await this._waitForConnectionReadyState(),"pong"!==e&&this._touchLastActivityAt(),"hello"!==e&&await this._waitForConnectionReady();e=JSON.stringify({c:e,d:t});this.ws.send(e)}_waitForConnectionReadyState(){return!1===this.socketConnected&&this._connect(!1),new Promise(e=>{if(this.ws&&1===this.ws.readyState)e();else{const t=setInterval(()=>{this.ws&&1===this.ws.readyState&&(clearInterval(t),e())},100)}})}_waitForConnectionReady(){return!1===this.socketConnected&&this._connect(!1),new Promise(e=>{if(this.socketReady)e();else{const t=setInterval(()=>{this.socketReady&&(clearInterval(t),e())},100)}})}_trigger(e,...t){if(void 0!==this.listeners[e])for(const o of this.listeners[e])setTimeout(()=>o(...t),0);"sessionRequest"!==e&&"function"==typeof y(e="on"+e.charAt(0).toUpperCase()+e.slice(1))&&y(e).apply(y(),t)}listen(...e){const t=e,o=t.pop();for(const n of t)this.listeners[n]=this.listeners[n]||[],this.listeners[n].push(o);return this}async resetConnection(e=!0){this._trigger("connectionReset"),await this.stopSession(),await this.resetIdentities(),this.connectionHasJustBeenReset=!0,this.ws.close(),e?this._connect():(this.socketShouldBeOpen=!1,this._initialConnect())}async resetIdentities(){i.default.clear(),this.shortId=null,this.lookupCode=null,y("identities",void 0),y("uniqueId",void 0),y("tags",void 0),y("integrationIds",void 0),sessionStorage.removeItem("__upscope:uniqueConnectionId");for(const e in sessionStorage)sessionStorage.hasOwnProperty(e)&&e.startsWith("__upscope:")&&sessionStorage.removeItem(e)}processQueue(){for(const o of window.Upscope.q){const[n,...s]=o;r("Received js command %s with args %o",n,s);try{switch(n){case"updateConnection":if(void 0===s[0])throw new Error("An argument is required");this.updateConnection(s[0]);break;case"reset":this.resetConnection(s[0]);break;case"stopSession":this.stopSession();break;case"requestAgent":this.requestAgent();break;case"cancelRequestAgent":this.cancelRequestAgent();break;case"newPageview":if(!this.historyCollector)throw new Error("History collection not enabled");this.historyCollector.pageview();break;case"logEvent":if(!this.historyCollector)throw new Error("History collection not enabled");this.historyCollector.log(s[0],s[1]);break;case"saveHistory":if(!this.historyCollector)throw new Error("History collection not enabled");this.historyCollector.save();break;case"submitRating":this.sessionRatingInfo&&this._emit("submitRating",{token:this.sessionRatingInfo.token,...s[0]});break;case"getUserId":case"getShortId":if(void 0===s[0])throw new Error("A callback is required");s[0](this.shortId);break;case"getWatchLink":if(void 0===s[0])throw new Error("A callback is required");s[0](this.getWatchLink());break;case"getConnectionId":if(void 0===s[0])throw new Error("A callback is required");s[0](this.uniqueConnectionId);break;case"getLookupCode":if(void 0===s[0])throw new Error("A callback is required");this.getLookupCode().then(e=>s[0](e));break;case"redirect":if("string"!=typeof s[0])throw new Error("A URL is required");this.linkProxyRewrite.redirect(s[0]);break;case"on":if(void 0===s[0]||"function"==typeof s[0])throw new Error("An event type is required");if("function"!=typeof s[s.length-1])throw new Error("An function is required");var e=s,t=s.pop();for(const i of e)this.listen(i,t);break;case"init":k("warn","It looks like you're trying to load Upscope more than once!");break;case"connect":break;default:k("error","Command "+n+" is not recognized")}}catch(e){k("error","Error processing command "+n,e,"(learn more here: https://docs.upscope.com/javascript-sdk/sdk-functions/#:~:text="+n+")")}}window.Upscope.q.length=0}}}.call(this,u("upscope:modules/connection.js"))},{"../dom-utils.js":2,"../utils.js":55,"./browser-instructions.js":4,"./browser-support.js":5,"./browser-watcher.js":23,"./console-handler.js":25,"./dialogs.js":26,"./fingerprint.js":27,"./history-collector.js":29,"./integration.js":30,"./link-proxy-rewrite.js":48,"./lookup-code-controller.js":49,"./phone-controller.js":50,"./request-agent-button-controller.js":51,"./storage.js":52,"./terminate-button-controller.js":53}],25:[function(n,e,i){!function(o){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var e=n("../utils.js");const t=["error","warn","info","log","debug"],s=navigator.userAgent&&navigator.userAgent.includes("MSIE")||navigator.appVersion&&0<navigator.appVersion.indexOf("Trident/");i.default=class{constructor(e){this.onConsole=e,this.console=[],this.consoleItemId=0}init(){this.initiated||(o("Initiating console handler"),this.initiated=!0,this._rewrite(),this._trackErrors())}_add(t,o,n=null){if(!(500<this.console.length)){let e=JSON.stringify(o);(!e||1e5<e.length)&&void 0!==o&&(e=JSON.stringify(o.toString().slice(0,1e5)));o={id:this.consoleItemId++,timestamp:Date.now(),level:t,message:e,stack:n.slice(0,1e5)};this.console.push(o),this.onConsole(o),500===this.console.length&&k("warn","Stopped logging console errors after 500 items.")}}execute(e){o("Received remote command %s",e),this._add("input",e),k("info","Remote console ",e);const t=(e,t=null)=>{if(t)return this._add("error",t.message);this._add("output",e),k("info","Remote console ",e)};try{t(eval.call(window,e))}catch(e){t(null,e)}}_rewrite(){for(const n of t)(0,e.intercept)(window.console,n,(...t)=>{if(this.console.length<=500)try{const o=s?null:(new Error).stack.toString().split("\n").splice(2);let e=t.join(" ");""===e&&(e=void 0),this._add(n,e,o&&o.map(e=>e.trim()).join("\n"))}catch(e){k("error","Error logging console item",e)}console["__original__"+n](...t)})}_trackErrors(){window.addEventListener("error",t=>{try{this._add("error",t.message,s||null===t.error||void 0===t.error.stack?null:t.error.stack.toString().split("\n").map(e=>e.trim()).join("\n"))}catch(e){k("error","Error logging console error",t,e)}})}}}.call(this,u("upscope:modules/console-handler.js"))},{"../utils.js":55}],26:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.alert=function(o,n){n||(n=o,o=null);return c(),new Promise(e=>{const t=new i(o,n,e);(s=t).addButton(void 0,y("translationsOk"),"ok"),t.render()})},o.clearDialogs=c,o.confirm=function(o,n){n||(n=o,o=null);return c(),new Promise(e=>{const t=new i(o,n,e);(s=t).addButton(!1,y("translationsNo"),"no"),t.addButton(!0,y("translationsYes"),"yes"),t.render()})};var r=(o=e("./internal-elements-css.js"))&&o.__esModule?o:{default:o};const a={".upscope___dialog-overlay":{position:"fixed",top:"0",left:"0",bottom:"0",right:"0",background:"#000000","z-index":"2147483645",opacity:"0.7"},".upscope___dialog":{display:"block","z-index":"2147483646",background:"white",position:"fixed",top:"50%",left:"50%",transform:"translateX(-50%) translateY(-50%)",width:"80%","max-width":"600px",padding:"15px 15px 0","border-radius":"5px",overflow:"hidden"},".upscope___dialog__title":{cursor:"default",display:"block","font-size":"20px",margin:"3px 0 15px","font-weight":"600",color:"#4c4c4c","font-family":"'Avenir Next', Avenir, 'Lucida Grande', Helvetica, sans-serif"},".upscope___dialog__text":{cursor:"default",display:"block","font-size":"17px","line-height":"22px",color:"#656565","font-weight":"500","margin-bottom":"30px","font-family":"'Avenir Next', Avenir, 'Lucida Grande', Helvetica, sans-serif"},".upscope___dialog__buttons-container":{background:"#f1f1f1",margin:"0 -15px",padding:"15px","text-align":"right",display:"block",overflow:"hidden"},".upscope___dialog__button, .upscope___dialog__button:hover, .upscope___dialog__button:active":{cursor:"pointer",background:"#0090ff",color:"white",padding:"0 10px",height:"36px","line-height":"36px",display:"inline-block","font-size":"17px","font-weight":"600","font-family":"'Avenir Next', Avenir, 'Lucida Grande', Helvetica, sans-serif","text-decoration":"none","border-radius":"3px","margin-left":"15px",opacity:"0.8"},'@media "only screen and (max-width": 800px)':{".upscope___dialog__buttons-container":{"padding-bottom":"0"},".upscope___dialog__button, .upscope___dialog__button:hover, .upscope___dialog__button:active":{display:"block",margin:"0 0 15px","text-align":"center"}},".upscope___dialog__button:hover":{opacity:"1"},".upscope___dialog__button.upscope___dialog__button--no":{background:"#dddddd",color:"#464646"},".upscope___dialog__button.upscope___dialog__button--ok":{background:"#00d015"}};let s;class n{constructor(e,t,o){this.text=e,this.onClick=o,this.className=t}render(e){const t=document.createElement("a");t.href="#",t.textContent=this.text,t.className="upscope___dialog__button"+(this.className?" upscope___dialog__button--"+this.className:""),t.setAttribute("role","button"),e.append(t),t.addEventListener("click",e=>{e.isUpscopeBrowserInstruction||(e.preventDefault(),e.stopPropagation(),this.onClick())})}}class i{constructor(e,t,o){this.title=e,this.text=t,this.callback=o,this.buttons=[],this.rendered=!1,this.container=null,this.keyboardListener=null}addButton(e,t,o){this.buttons.push(new n(t,o,()=>{this.clear(),this.callback&&this.callback(e),this.callback=null}))}clear(){this.rendered&&(this.keyboardListener&&document.removeEventListener("keydown",this.keyboardListener),this.container.remove())}render(){this.rendered=!0,this.container=(0,r.default)(document,a);const e=document.createElement("div"),t=(e.className="upscope___dialog-overlay",1===this.buttons.length&&(e.addEventListener("click",e=>{this.buttons[0].onClick()}),this.keyboardListener=e=>{27!==e.keyCode&&13!==e.keyCode&&8!==e.keyCode||this.buttons[0].onClick()},document.addEventListener("keydown",this.keyboardListener)),document.createElement("div")),o=(t.className="upscope___dialog",t.setAttribute("role","dialog"),t.setAttribute("aria-labelledby","upscope___dialog__title"),t.setAttribute("aria-describedby","upscope___dialog__text"),document.createElement("div")),n=(o.className="upscope___dialog__title",o.id="upscope___dialog__title",o.textContent=this.title||b().hostname,t.append(o),document.createElement("div")),s=(n.className="upscope___dialog__text",n.id="upscope___dialog__text",n.textContent=this.text,t.append(n),document.createElement("div"));s.className="upscope___dialog__buttons-container";for(const i of this.buttons)i.render(s);t.append(s),this.container.append(t),this.container.append(e),document.activeElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur()}}function c(){s&&s.clear(),s=null}},{"./internal-elements-css.js":47}],27:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=async function(){let e=0;for(const o in navigator)e++;let t;try{t=await navigator.getBattery()}catch(e){t=null}return function(t){let o=0;for(let e=0;e<t.length;e++)o=(o<<5)-o+t.charCodeAt(e),o=Math.trunc(o);return Math.abs(o)}([navigator.userAgent,navigator.platform,navigator.cookieEnabled,navigator.languages,navigator.deviceMemory,navigator.hardwareConcurrency,screen.width,screen.height,screen.colorDepth,screen.pixelDepth,screen.availTop,screen.availHeight,screen.availWidth,e,t?t.charging:null,window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches:null,function(){const e=document.createElement("canvas"),t=e.getContext("2d"),o="upscope.io";return t.textBaseline="top",t.font='14px "Arial"',t.textBaseline="alphabetic",t.rotate(.05),t.fillStyle="#f60",t.fillRect(125,1,62,20),t.fillStyle="#069",t.fillText(o,2,15),t.fillStyle="rgba(102, 204, 0, 0.7)",t.fillText(o,4,17),e.toDataURL()}()].flat().map(String).join(":"))}},{}],28:[function(r,e,a){!function(o){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var e,t=r("../utils.js"),n=(e=r("./browser-watcher.js"))&&e.__esModule?e:{default:e};a.default=class{constructor(){this._listenParent(),this._listenChildren()}async isChild(){if(this.parentFrameHandler)return!0;if(!window.parent||window.parent===window)return o("Parent is self, not a child");o("Will contact parent window");var e="extension"===window.__upscopeContext__&&window.top!==window;return window.parent.postMessage({__upscopeApiKey:y("apiKey"),c:"register"},"*"),await Promise.race([(0,t.sleep)(500),(0,t.until)(()=>this.parentFrameHandler)]),void 0!==this.parentFrameHandler||e}_listenParent(){window.addEventListener("message",e=>{e.source===window.parent&&e.data.__upscopeApiKey===y("apiKey")&&(this.parentFrameHandler=this.parentFrameHandler||new s,this.parentFrameHandler.handle(e.data))})}_listenChildren(){window.addEventListener("message",t=>{const e=[...document.querySelectorAll("iframe,frame")].find(e=>e.contentWindow===t.source);e&&t.data.__upscopeApiKey===y("apiKey")&&(e.__upscopeChildFrameHandler=e.__upscopeChildFrameHandler||new i(e),e.__upscopeChildFrameHandler.handle(t.data))})}};class s{constructor(){this.watcher=new n.default((e,t)=>{window.parent.postMessage({__upscopeApiKey:y("apiKey"),c:"event",iframe:e,event:t},"*")},null,!0)}handle(e){var t=e["c"];switch(t){case"registered":return o("Parent frame recognized child frame");case"activate":return this.watcher.active?void 0:(o("Parent frame asked to activate, rootId is %s",e.rootId),this.activate(e.rootId));case"deactivate":return o("Parent frame asked to deactivate"),this.deactivate();case"getSnapshot":return o("Parent frame asked for snapshot"),this.getSnapshot(e.rootId)}}activate(e){this.watcher.activate(e)}deactivate(){this.watcher.deactivate()}async getSnapshot(e){this.watcher._ensureHasIds(null,document,e);e=await this.watcher.getSnapshot();window.parent.postMessage({__upscopeApiKey:y("apiKey"),c:"snapshot",snapshot:e},"*")}}class i{constructor(e){this.iframe=e}handle(e){o("Received message %o from iframe %o",e,this.iframe);var t=e["c"];switch(t){case"register":return o("Child iframe %o asked to register",this.iframe),this.iframe.contentWindow.postMessage({__upscopeApiKey:y("apiKey"),c:"registered"},"*");case"event":return o("Child iframe %o sent event %o",this.iframe,e.event),void(this.eventListener&&this.eventListener(e.iframe,e.event));case"snapshot":o("Child iframe %o sent snapshot %o",this.iframe,e.snapshot),this.snapshotListener&&this.snapshotListener(e.snapshot)}}activate(e,t){this.eventListener=e,this.iframe.contentWindow.postMessage({__upscopeApiKey:y("apiKey"),c:"activate",rootId:t},"*")}deactivate(){delete this.eventListener,this.iframe.contentWindow.postMessage({__upscopeApiKey:y("apiKey"),c:"deactivate"},"*")}getSnapshot(e){return Promise.race([new Promise(t=>{this.iframe.contentWindow.postMessage({__upscopeApiKey:y("apiKey"),c:"getSnapshot",rootId:e},"*"),this.snapshotListener=e=>{t(e),delete this.snapshotListener}}),(0,t.sleep)(5e3)])}}}.call(this,u("upscope:modules/frame-handler.js"))},{"../utils.js":55,"./browser-watcher.js":23}],29:[function(e,t,n){!function(r){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=e("../utils.js");n.default=class{constructor(e,t){this.connection=e,this.watcher=t,this.storage=new o,this.autoSaveIsOn=null,this.pageview(),this._addEventsTracking()}async pageview(){this.currentPageview&&this.storage.add(this.currentPageview),this.currentPageview={pageviewId:(0,a.uuid)(),screenshot:null,ts:new Date,tse:new Date,url:b().href,events:[]},await(0,a.until)(()=>"complete"===document.readyState),this._updateScreenshot(),sessionStorage.getItem("__upscope:historyAutoSaveOn")&&this.turnAutoSaveOn()}log(e,t){if(!["success","error","info","warn","contact"].includes(e))throw new Error(`Event log type ${e} not supported`);if(!t)throw new Error("Event log text required");this._addEvent("log",{type:e,text:t})}enterFrom(){const e=document.referrer,t=e&&(0,a.parseUrl)(e).hostname;!t||b().hostname.includes(t)||t.includes(b().hostname)||this._addEvent("enter_from",{url:e})}leaveTo(){const e=(0,a.attempt)(()=>document.activeElement.href),t=e&&window.URL&&(0,a.parseUrl)(e).hostname;!t||b().hostname.includes(t)||t.includes(b().hostname)||this._addEvent("leave_to",{url:e})}click(e){var t;("A"===e.tagName||"A"===e.tagName||"INPUT"===e.tagName&&["button","submit","reset"].includes(e.type))&&(t=e.id||null,e=e.textContent||e.value,r("Detected click %o",{label:e,id:t}),this._addEvent("click",{label:e,id:t}))}form(e){var t=e.id||e.name||null,o=(0,a.attempt)(()=>e.labels[0].textContent.trim())||(0,a.attempt)(()=>e.placeholder.trim())||null;let n,s=!1,i;if("INPUT"===e.tagName&&["text","tel","number","search","url","email"].includes(e.type))i="text",n=e.value;else if("INPUT"===e.tagName&&"password"===e.type)i="password",n=null,s=!0;else if("INPUT"===e.tagName&&"checkbox"===e.type)i="bool",n=e.checked;else if("INPUT"===e.tagName&&"file"===e.type&&e.value)i="file";else{if("SELECT"!==e.tagName)return;i="multiple",n=(0,a.attempt)(()=>e.options[e.selectedIndex].textContent.trim())||e.value,s=!0}y("maskElementMiddleware")(e)&&(n=null,s=!0),r("Detected form input %o",{label:o,id:t,value:n,redacted:s,formType:i}),this._addEvent("form",{label:o,id:t,value:n,redacted:s,formType:i})}async save(){if(!this.pendingSave){this.pendingSave=!0;try{await(0,a.until)(()=>!this.pendingEvent),await(0,a.until)(()=>this.connection.shortId);var e=await this.storage.get();0<e.length&&(await this.connection._reportPageviews(e),r("Saved pageviews")),this.storage.clear(),this.currentPageview.events=[],this.currentPageview.screenshot=null}catch(e){r("Could not save pageviews")}this.turnAutoSaveOn(),this.pendingSave=!1}}turnAutoSaveOn(){this.autoSaveIsOn||(this.autoSaveIsOn=!0,this.storage.goLocal(),sessionStorage.setItem("__upscope:historyAutoSaveOn",!0),setInterval(this.save.bind(this),1e3))}_addEventsTracking(){this.enterFrom(),document.addEventListener("click",e=>this.click(e.target)),document.addEventListener("input",e=>this.form(e.target)),window.addEventListener("beforeunload",()=>this.leaveTo())}_addEvent(t,o){this.pendingEvent=!0,(o.label||o.id)&&(this.currentPageview.events=this.currentPageview.events.filter(e=>e.type!==t||(e.details.id||e.details.label)!==(o.id||o.label))),this.currentPageview.events.push({eventId:(0,a.uuid)(),ts:new Date,type:t,details:o}),this.currentPageview.tse=new Date,this.storage.add(this.currentPageview),this._updateScreenshot()}async _updateScreenshot(){try{var e,t,o,n;this.slowScreenshotWait||(this.slowScreenshotWait=!0,e=new Date,r("Taking screenshot for events"),(t=JSON.stringify(await this.watcher.getSnapshot(window,!0))).length<8e5||this.autoSaveIsOn?this.currentPageview.screenshot=t:r("Screenshot is too big: discarding"),await this.storage.add(this.currentPageview),o=Date.now()-e,n=Math.max(5e3,19*o),r("Screenshot took %sms, will wait %sms before next",o,n),setTimeout(()=>delete this.slowScreenshotWait,n))}finally{this.pendingEvent=!1}}};class o{goLocal(){this.isLocal=!0}async add(t){await(0,a.until)(()=>!this.pendingChanges);try{let e=await this.get();this.pendingChanges=!0,e.some(e=>e.pageviewId===t.pageviewId)?e=e.map(e=>e.pageviewId===t.pageviewId?t:e):e.unshift(t),this.isLocal||sessionStorage.setItem("__upscope:pageviews",JSON.stringify(e)),this.pageviews=e}catch(e){(0,a.attempt)(()=>sessionStorage.removeItem("__upscope:pageviews"))}finally{this.pendingChanges=!1}}async clear(){await(0,a.until)(()=>!this.pendingChanges);try{this.pendingChanges=!0,sessionStorage.removeItem("__upscope:pageviews"),this.pageviews=null}finally{this.pendingChanges=!1}}async get(){await(0,a.until)(()=>!this.pendingChanges);try{if(this.isLocal)return this.pageviews||[];this.pendingChanges=!0;let e=sessionStorage.getItem("__upscope:pageviews");e=e?JSON.parse(e):[];const t=[];for(const o of e)if(5<t.length&&(o.screenshot=null),Date.now()-new Date(o.tse)<864e3&&t.push(o),30===t.length)break;return t}finally{this.pendingChanges=!1}}}}.call(this,u("upscope:modules/history-collector.js"))},{"../utils.js":55}],30:[function(e,t,n){!function(o){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var t=e("./integrations");n.default=class{constructor(e){this.connection=e,this.isLive=!1,this.watchLink=null,this.isInitiated=!1,this.integration=null,this.integrationId=null,this.integrationUserUniqueId=void 0,this.integrationUserIdentities=void 0}init(){if(y("integrateWithLivechat")&&!y("fromProxy")&&!this.isInitiated&&(o("Initiating live chat integration system"),this.trySetup(),null===this.integration)){let e=0;const t=setInterval(()=>{20<++e&&e<40&&e%4!=0||40<e&&e%15!=0||(this.trySetup(),null!==this.integration&&clearInterval(t))},500)}}trySetup(){if(this._detect(),null!==this.integration){if(this.isInitiated=!0,window.Upscope._integration=this.integrationId,y("grabIdentityFromLivechat"))try{this.integration.getUserId&&(this.integrationUserUniqueId=this.integration.getUserId()),this.integration.getIdentities&&(this.integrationUserIdentities=this.integration.getIdentities()),o("Retrieved identities from live chat (%o)",[this.integrationUserUniqueId,this.integrationUserIdentities])}catch(e){o("Error while retrieving identities from live chat. (%o)",e)}this.rewrite(),this.trackOpens(),this.getIntegrationIdentifier(),this.watchLink&&this.live(this.watchLink)}}async live(e){if(this.watchLink=e,null!==this.integration&&"function"==typeof this.integration.live&&!this.isLive){o("Providing live chat watch link (%s)",e);try{await this.integration.live(e),this.isLive=!0,o("Watch link added to live chat")}catch(e){o("Error adding watch link to live chat. (%o)",e)}}}rewrite(){if("function"==typeof this.integration.rewrite&&y("liveChatRewrite"))try{this.integration.rewrite(),o("Patched live chat object")}catch(e){o("Error while patching live chat object. (%o)",e)}}async trackOpens(){if("function"==typeof this.integration.onOpen)try{await this.integration.onOpen(()=>{this.connection._connect(),sessionStorage.setItem("__upscope:integrationOpened",!0),this.connection.historyCollector&&setTimeout(()=>{this.connection.historyCollector.log("contact","Started chat conversation"),this.connection.historyCollector.save()},100)}),o("Tracked live chat opens")}catch(e){o("Error while tracking live chat opens. (%o)",e)}}async getIntegrationIdentifier(){if("function"==typeof this.integration.getIntegrationIdentifier)try{var e=await this.integration.getIntegrationIdentifier();e&&this.connection.updateConnection({integrationIds:[this.integrationId+":"+e]}),o("Got unique identifier from %s: %s",this.integrationId,e)}catch(e){o("Could not get identifier from %s. (%o)",this.integrationId,e)}}_detect(){for(const e of t.integrations)e.detect()&&(this.integration=e,this.integrationId=e.id);null===this.integration?o("No live chat integration found"):o('Live chat integration "%s" found',this.integrationId)}}}.call(this,u("upscope:modules/integration.js"))},{"./integrations":37}],31:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0,o.default={id:"chatra",detect(){return void 0!==window.Chatra},live(e){const t=window.Chatra;t("updateIntegrationData",{"Screen share":e})}}},{}],32:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0,o.default={id:"drift",detect(){return void 0!==window.drift},live(e){window.drift.on("ready",()=>{window.drift.api.setUserAttributes({screenShare:e})})}}},{}],33:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0,o.default={id:"freshchat",detect(){return void 0!==window.fcWidget},live(e){window.fcWidget.user.update({meta:{screenshare:e}})},getUserId(){if(window.fcSettings&&window.fcSettings.externalId)return window.fcSettings.externalId},getIdentities(){if(window.fcSettings&&window.fcSettings.firstName&&window.fcSettings.lastName)return[window.fcSettings.firstName+" "+window.fcSettings.lastName]}}},{}],34:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=e("../../utils");function s(){return(0,n.attempt)(()=>window.FrontChat("user_id"))}o.default={id:"front",detect(){return"function"==typeof window.FrontChat&&(0,n.attempt)(s)},async getIntegrationIdentifier(){try{await(0,n.timeout)((0,n.until)(s),1e4)}catch(e){return null}return s()},onOpen(t){const o=setInterval(()=>{var e=document.querySelector("#front-chat-container");e&&100<e.clientHeight&&(clearInterval(o),t())},1e3)}}},{"../../utils":55}],35:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0,o.default={id:"happyfox",detect(){return void 0!==window.HFCHAT_CONFIG},rewrite(){let e=0;const t=setInterval(()=>{3e3<e&&(k("info","To integrate with HappyFoxChat, you need to add the following to the installation code.",`

    window.HFCHAT_CONFIG.onload = function (data) {
      window.__upscopeHappyFoxChat = this;
    };

`,"To turn off this warning (and not integrate with Happy Fox Chat), add \"integrateWithLivechat: false\" to the Upscope('init') configuration."),clearInterval(t)),void 0===window.__upscopeHappyFoxChat?e+=100:clearInterval(t)},100)},live(e){const t=setInterval(()=>{void 0!==window.__upscopeHappyFoxChat&&(clearInterval(t),window.__upscopeHappyFoxChat.setCustomFields({ScreenShare:e},(e,t)=>{e&&(k("error","HappyFox Chat error",e),k("info",'To integrate with HappyFoxChat, you need to create a custom field of type "text" named "ScreenShare"'))}))},100)}}},{}],36:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0,o.default={id:"helpscout",detect(){return"function"==typeof window.Beacon},live(e){window.Beacon("identify",{Screenshare:e})}}},{}],37:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.integrations=void 0;var n=m(e("./chatra.js")),s=m(e("./drift.js")),i=m(e("./freshchat.js")),r=m(e("./front.js")),a=m(e("./happyfox.js")),c=m(e("./helpscout.js")),l=m(e("./intercom.js")),u=m(e("./livechat.js")),d=m(e("./olark.js")),p=m(e("./reamaze.js")),h=m(e("./sendinblue.js")),f=m(e("./sfdc.js")),g=m(e("./tawk.js")),_=m(e("./zendesk.js")),e=m(e("./zoho.js"));function m(e){return e&&e.__esModule?e:{default:e}}n=[n.default,s.default,i.default,r.default,a.default,c.default,l.default,u.default,d.default,p.default,h.default,f.default,g.default,_.default,e.default];o.integrations=n},{"./chatra.js":31,"./drift.js":32,"./freshchat.js":33,"./front.js":34,"./happyfox.js":35,"./helpscout.js":36,"./intercom.js":38,"./livechat.js":39,"./olark.js":40,"./reamaze.js":41,"./sendinblue.js":42,"./sfdc.js":43,"./tawk.js":44,"./zendesk.js":45,"./zoho.js":46}],38:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=e("../../utils.js");o.default={id:"intercom",detect(){return void 0!==window.Intercom},live(e){this.watchLink=e,window.Intercom("update",{screenshare:e}),"object"==typeof window.intercomSettings&&(window.intercomSettings.screenshare=e)},async onOpen(e){await(0,n.until)(()=>Boolean(window.Intercom.booted)),window.Intercom("onShow",e)},getUserId(){if(window.intercomSettings&&window.intercomSettings.user_id)return window.intercomSettings.user_id},getIdentities(){if(window.intercomSettings&&window.intercomSettings.name)return[window.intercomSettings.name]},async getIntegrationIdentifier(){try{await(0,n.timeout)((0,n.until)(()=>Boolean(window.Intercom("getVisitorId"))),1e4)}catch(e){return null}return window.Intercom("getVisitorId")}}},{"../../utils.js":55}],39:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=e("../../utils.js");o.default={id:"livechat",detect(){return void 0!==window.__lc},rewrite(){window.__lc.params=window.__lc.params||[],this.liveChatCustomVars=window.__lc.params,this.rewrittenFunc=e=>{this.liveChatCustomVars=e,this.watchLink&&e.push({name:"Screenshare",value:this.watchLink}),window.LC_API.__original__set_custom_variables(e)},(0,n.intercept)(window.LC_API,"set_custom_variables",this.rewrittenFunc)},async live(e){this.watchLink=e,await(0,n.until)(()=>window.LC_API.is_loaded()),window.LC_API.set_custom_variables!==this.rewrittenFunc&&(0,n.intercept)(window.LC_API,"set_custom_variables",this.rewrittenFunc),window.LC_API.set_custom_variables(this.liveChatCustomVars)},onOpen(t){const o=window.LC_API.on_chat_started;window.LC_API.on_chat_started=e=>{"function"==typeof o&&o(),t()}},getUserId(){if(window.__lc&&window.__lc.visitor&&window.__lc.visitor.email)return window.__lc.visitor.email},getIdentities(){if(window.__lc&&window.__lc.visitor&&window.__lc.visitor.name)return[window.__lc.visitor.name]},async getIntegrationIdentifier(){try{await(0,n.timeout)((0,n.until)(()=>(0,n.attempt)(()=>/^(?:[\dA-z]+-){4}[\dA-z]+$/.test(window.LC_API.get_visitor_id()))),1e4)}catch(e){return null}return window.LC_API.get_visitor_id()||null}}},{"../../utils.js":55}],40:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=e("../../utils");o.default={id:"olark",detect(){return void 0!==window.olark},rewrite(){this.lastSentSnippet=[];const o=this;(0,n.intercept)(window,"olark",(...t)=>{if("api.chat.updateVisitorStatus"===t[0]){let e=t[1]["snippet"];o.lastSentSnippet="object"==typeof e?e:[e],(e=o.lastSentSnippet.slice()).push("Screenshare: "+this.watchLink),t[1].snippet=e}window.__original__olark(...t)})},live(e){this.watchLink=e,window.olark("api.chat.updateVisitorStatus",{snippet:this.lastSentSnippet})}}},{"../../utils":55}],41:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0,o.default={id:"reamaze",detect(){return void 0!==window._support&&document.documentElement.innerHTML.includes("reamaze")},live(e){const t=setInterval(()=>{if(void 0!==window.Reamaze){clearInterval(t);try{window._support.custom_fields=window._support.custom_fields||{},window._support.custom_fields["Screen share"]={type:"hidden",value:e},window.Reamaze.reload()}catch(e){k("Error with reamaze api",e)}}},100)}}},{}],42:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0,o.default={id:"sendinblue",detect(){return void 0!==window.SibConversations},live(e){const t=window.SibConversations;t("updateIntegrationData",{"Screen share":e})}}},{}],43:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=e("../../utils");o.default={id:"sfdc",detect(){return void 0!==window.embedded_svc},async live(e){await(0,n.until)(()=>window.embedded_svc.settings);e={label:y("sfdcFieldLabel"),value:e,transcriptFields:[y("sfdcFieldId")],displayToAgent:!0};window.embedded_svc.settings.extraPrechatFormDetails?"function"==typeof window.embedded_svc.settings.extraPrechatFormDetails.push?window.embedded_svc.settings.extraPrechatFormDetails.push(e):k("error","Error integrating with SFDC chat"):window.embedded_svc.settings.extraPrechatFormDetails=[e]}}},{"../../utils":55}],44:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0,o.default={id:"tawk",detect(){return void 0!==window.Tawk_API},live(e){const t=setInterval(()=>{if("function"==typeof window.Tawk_API.setAttributes){clearInterval(t);try{window.Tawk_API.setAttributes({ScreenShare:e})}catch(e){k("info","Error with twak api",e)}}},100)}}},{}],45:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=e("../../utils.js");o.default={id:"zendesk",detect(){return void 0!==window.$zopim&&void 0!==window.$zopim.livechat},getUserId(){var e=window.$zopim.livechat.getEmail()||null;if(e)return e},getIdentities(){var e=window.$zopim.livechat.getName()||null;if(e)return[e]},onOpen(e){window.$zopim.livechat.setOnChatStart(e)},async getIntegrationIdentifier(){try{await(0,n.timeout)((0,n.until)(()=>document.cookie.includes("__zlcmid=")),1e4)}catch(e){return null}return document.cookie.split("__zlcmid=").pop().split(";").shift().trim()}}},{"../../utils.js":55}],46:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0,o.default={id:"zoho",detect(){return"object"==typeof window.$zoho&&void 0!==window.$zoho.salesiq},live(e){const t=setInterval(()=>{if(window.$zoho.salesiq.visitor&&"function"==typeof window.$zoho.salesiq.visitor.info){clearInterval(t);try{window.$zoho.salesiq.visitor.info({"Screen share":e})}catch(e){k("info","Error with zoho api",e)}}},100)}}},{}],47:[function(e,t,o){"use strict";function c(e){return Object.values(e).some(e=>"object"==typeof e)?Object.entries(e).map(([e,t])=>""+e+` {
${c(t)}
}`).join("\n"):Object.entries(e).map(([e,t])=>e+`: ${t};
`).join("")}Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(e,t,{id:o,className:n}={}){const s=e.createElement("div");o&&(s.id=o);n&&(s.className=n);if(s.attachShadow&&s.attachShadow.toString().includes("[native code]")){s.attachShadow({mode:"open"}),e.body.append(s);const i=e.createElement("style");return i.textContent=c(t),s.shadowRoot.append(i),s.shadowRoot.remove=s.remove.bind(s),s.shadowRoot}s.id=s.id||"upscope--"+Math.random().toString(36).slice(2,10);const i=e.createElement("style"),r=[],a=e.defaultView.getComputedStyle(e.body);for(let e=0;e<a.length;e++)r.push(a[e]);return i.textContent=`
  #${s.id}, #${s.id} * {
    ${r.map(e=>e+": initial").join(";\n")}
  }
  
  ${c(t).split(";\n").join(" !important;\n")}
  `,e.head.append(i),e.body.append(s),s},o.objectToCss=c},{}],48:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};t=r(t);if(t&&t.has(e))return t.get(e);var o,n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e){var i;"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&((i=s?Object.getOwnPropertyDescriptor(e,o):null)&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=e[o])}n.default=e,t&&t.set(e,n);return n}(e("../dom-utils.js"));function r(e){var t,o;return"function"!=typeof WeakMap?null:(t=new WeakMap,o=new WeakMap,(r=function(e){return e?o:t})(e))}o.default=class{constructor(e){!y("rewriteExternalLinks")||y("fromProxy")||(this.connection=e,this.killers=[],e.listen("sessionStart","sessionContinue",this.activate.bind(this)).listen("sessionEnd",this.deactivate.bind(this)))}activate(e=document){this.active=!0;const t=this._handleEvent.bind(this);e.addEventListener("click",t),e.addEventListener("submit",t),this.killers.push(()=>{e.removeEventListener("click",t),e.removeEventListener("submit",t)}),n.doForIframes(e,e=>this.activate(e.contentDocument))}deactivate(){this.active=!1;for(const e of this.killers)e();this.killers.length=0}redirect(e){this.active&&(e=this._rewriteLink(e)),location.href=e}_handleEvent(t){if(!t.__upscopeIsProxyRewritten){let e;if(t.target.href&&y("needsProxy")(t.target.href)){t.preventDefault();const n=t.target.href,s=t.target.target;t.target.href=this._rewriteLink(t.target.href),t.isUpscopeBrowserInstruction&&(t.target.target="_self"),e=()=>{t.target.href=n,t.target.target=s}}else{if(!t.target.action||!y("needsProxy")(t.target.action))return;{t.preventDefault();const i=t.target.action;t.target.action=this._rewriteLink(t.target.action),e=()=>{t.target.action=i}}}const o=new t.constructor(t.type,t);o.__upscopeIsProxyRewritten=!0,t.target.dispatchEvent(o),e()}}_rewriteLink(e){return e+=(e.includes("?")?"&":"?")+"__upscope_short_id="+this.connection.shortId,y("proxyRedirectEndpoint").replace("URL",encodeURIComponent(e)).replace("TOKEN",encodeURIComponent(this.connection.proxyToken))}}},{"../dom-utils.js":2}],49:[function(a,e,c){!function(o){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var e,n=a("../dom-utils.js"),t=a("../utils.js"),s=(e=a("./internal-elements-css.js"))&&e.__esModule?e:{default:e},i=a("./dialogs.js");const r={"#upscope___lookup-code-button":{background:"#464646","background-image":"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAcCAYAAAAJKR1YAAAABGdBTUEAALGPC/xhBQAAAYZJREFUSA3tVjFugzAUjUlPUKZIyVSpa2+A2BAXqThBD9ETcIMeAbEhbtC1UqcgZSI3KPQ9ioekGNvUrhhiySHA83uPxxf+m77vU8wjpq9B7nRjOATAR2D3hvilsEYIcTBaLGMxAi8A2fIHCzS8LrkZ0sXLou4JQtGJa3Capvuu615xPQZsd33fxTlkT+CpgiB4KYqiURoazbzDyL0LYR0HjJ1h6ulOBWQyNBNF0UeWZQ9hGG5V2L9cb9v2K8/zz7quH6k5V9QxhXyaIT8flBr8jxErE5I1I5NJkuRniePfsiwHU6Sl5lxCjqXN6G6GdDkxoYYgvL+LoVvo6z4NPWMOpnyJ2PAG+CAVmAfMi2FD4hK7/qKWheTyqW241p+QLCSbp3KJXV1Cyr0MSZ1QTzvuxtzPuOf4GtQA95aacwlVNMDWYFzAU+dDth8jcfWrS5SKpg2aaXK6bgHpDA2aMiG2k+zgAHxjlNKo6yO5qUGtoYW1FeB3ynbNFB4mJt+OMqEpkv+49g2gcw5a2MSfIAAAAABJRU5ErkJggg==')","background-size":"18px 14px","background-position":"right 5px center","background-repeat":"no-repeat","box-shadow":"1px 1px 2px 0 rgba(0, 0, 0, 0.3)",width:"60px",height:"40px",position:"fixed",cursor:"help",display:"block",color:"white","font-family":"Courier New","font-weight":"bold","text-align":"right","line-height":"40px","padding-right":"30px","font-size":"18px",transition:"transform 0.5s","z-index":"2147483645",transform:"translateX(-75px)"},"#upscope___lookup-code-button:hover":{transform:"translateX(-68px)"},"#upscope___lookup-code-button.upscope___lookup-code-button--active":{transform:"translateX(-5px)"},'#upscope___lookup-code-button[data-align="right"]':{"background-position":"left 5px center","padding-left":"30px","padding-right":"0",transform:"translateX(75px)","text-align":"left"},'#upscope___lookup-code-button[data-align="right"]:hover':{transform:"translateX(68px)"},'#upscope___lookup-code-button[data-align="right"].upscope___lookup-code-button--active':{transform:"translateX(5px)"}};c.default=class{constructor(e){if(this.connection=e,y("injectLookupCodeButton")){if(!this.pageMatchesForButton())return o("Not showing lookup code button as the page does not match");this.injectButtonElements()}y("lookupCodeElement")&&this.populateElement(),y("enableLookupCodeOnKey")&&this.listenForKeySequence(),this.listenForTargetChange()}async handleButtonClick(e){e.preventDefault(),sessionStorage.setItem("__upscope:lookupCodeClick",!0),this.linkElement.textContent=await this.connection.getLookupCode(),this.linkElement.className="upscope___lookup-code-button--active",this.resetTimeout&&clearTimeout(this.resetTimeout),this.resetTimeout=setTimeout(()=>{this.linkElement.className=""},5e3)}pageMatchesForButton(){for(const e of y("lookupCodeButtonPages"))if((0,t.matchesPattern)(e,b().href))return!0;return!1}populateElement(){let t=0,o=!1;setInterval(async()=>{if(!o||t%10==0){const e=y("lookupCodeElement")instanceof Element?y("lookupCodeElement"):document.querySelector(y("lookupCodeElement"));e?(e.textContent=await this.connection.getLookupCode(),o=!0,t++):o=!1}},100)}listenForKeySequence(){const t=e=>{e&&(e.__upscopeLookupSequenceListenerActive||e.addEventListener("keyup",this.handleKeyUp.bind(this)),e.__upscopeLookupSequenceListenerActive=!0,(0,n.doForIframes)(e,e=>t(e.contentDocument),null,!0))};t(document),setInterval(()=>t(document),1e3)}handleKeyUp(e){this.sequence=this.sequence||0,this.sequenceStartedAt=this.sequenceStartedAt||null,!(0<this.sequence&&e.keyCode!==y("lookupCodeKey"))&&e.keyCode===y("lookupCodeKey")?((null===this.sequenceStartedAt||1e4<Date.now()-this.sequenceStartedAt)&&(this.sequenceStartedAt=new Date,this.sequence=0),this.sequence++):(this.sequence=0,this.sequenceStartedAt=null),this.sequence===y("lookupCodeKeyRepetitions")&&(this.showAlert(),sessionStorage.setItem("__upscope:lookupCodeClick",!0),this.sequence=0,this.sequenceStartedAt=null)}async showAlert(){var e=await this.connection.getLookupCode();(0,i.alert)(y("lookupCodeKeyTitle").split("{%lookupCode%}").join(e),y("lookupCodeKeyMessage").split("{%lookupCode%}").join(e))}listenForTargetChange(){"#upscope-lookup-code"===location.hash&&(o("Page had #upscope-lookup-code target at pageload"),this.showAlert(),sessionStorage.setItem("__upscope:lookupCodeClick",!0),history.replaceState("",document.title,window.location.pathname+window.location.search)),window.addEventListener("hashchange",()=>{"#upscope-lookup-code"===location.hash&&(o("User clicked on #upscope-lookup-code link"),this.showAlert(),sessionStorage.setItem("__upscope:lookupCodeClick",!0),history.back())})}injectButtonElements(){if(!this.linkElement||!document.querySelector("#upscope___lookup-code-button-container")){o("Adding promo link element");const e=document.createElement("div"),t=(0,s.default)(document,r,{id:"upscope___lookup-code-button-container"});e.id="upscope___lookup-code-button",e.title="Screenshare code (by upscope.com)",e.style.cssText=y("lookupCodeButtonStyle").split(";").join(";"),y("lookupCodeButtonStyle").includes("right")&&(e.dataset.align="right"),e.addEventListener("click",this.handleButtonClick.bind(this)),t.append(e),this.linkElement=e}}}}.call(this,u("upscope:modules/lookup-code-controller.js"))},{"../dom-utils.js":2,"../utils.js":55,"./dialogs.js":26,"./internal-elements-css.js":47}],50:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=e("./dialogs.js");o.default=class{constructor(){this.callback=null}handleResponse(e){this.callback&&(this.callback(e),this.hide())}show(e){this.callback=e,(0,n.confirm)(y("callPromptText")).then(this.handleResponse.bind(this)),y("callRingtone")&&(this.audio=this.audio||new Audio(y("callRingtone")),this.audio.loop=!0,this.audio.play())}hide(){(this.callback=null,n.clearDialogs)(),this.audio&&this.audio.pause()}}},{"./dialogs.js":26}],51:[function(n,e,s){!function(a){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var e,t=n("../utils.js"),c=(e=n("./internal-elements-css.js"))&&e.__esModule?e:{default:e},o=n("./dialogs.js");const l={"#upscope___request-agent-button":{"background-image":"url(\"data:image/svg+xml,%3Csvg width='19' height='25' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M16.856 24.393a.825.825 0 0 1-.477.514c-.23.096-.46.118-.686.065-3.568-.82-6.675-2.472-9.321-4.954a20.246 20.246 0 0 1-5.456-8.701C-.16 7.858-.288 4.35.536.795A1.1 1.1 0 0 1 .894.21a.829.829 0 0 1 .673-.202H6.22c.24-.004.46.077.66.242.2.165.317.37.35.615l.94 5.21a.938.938 0 0 1-.1.624 1.296 1.296 0 0 1-.472.493L4.57 8.68a15.243 15.243 0 0 0 2.076 5.138 15.98 15.98 0 0 0 3.707 4.085l2.67-2.061c.208-.13.426-.2.651-.207a.946.946 0 0 1 .606.184l4.286 3.127c.207.137.341.331.402.583a.978.978 0 0 1-.072.697l-2.039 4.168z' fill='%2362BB00' fill-rule='evenodd' fill-opacity='.95'/%3E%3C/svg%3E\"), linear-gradient(0deg, #F8F8F8 0%, #FFFFFF 98%)","background-size":"19px 25px, cover","background-position":"left 15px center, 0 0","background-repeat":"no-repeat","box-shadow":"0 1px 5px 0 rgba(0,0,0,0.20)","z-index":"2147483645",display:"none",position:"fixed",padding:"10px 10px 10px 44px","font-family":"'Avenir Next', 'Avenir', 'Helvetica', sans-serif","border-radius":"3px",cursor:"pointer",transition:"opacity 0.3s, box-shadow 0.3s","user-select":"none",opacity:"0.95"},"#upscope___request-agent-button span":{display:"block"},"#upscope___request-agent-button__title, #upscope___request-agent-button__requesting-title":{"font-size":"16px","font-weight":"500","padding-right":"10px"},"#upscope___request-agent-button__subtitle,#upscope___request-agent-button__requesting-subtitle":{"font-size":"14px"},"#upscope___request-agent-button__requesting-title,#upscope___request-agent-button__requesting-subtitle":{visibility:"hidden",height:"0"},".upscope___request-agent-button--pending #upscope___request-agent-button__requesting-title,.upscope___request-agent-button--pending #upscope___request-agent-button__requesting-subtitle":{visibility:"visible",height:"auto"},".upscope___request-agent-button--pending #upscope___request-agent-button__title,.upscope___request-agent-button--pending #upscope___request-agent-button__subtitle":{visibility:"hidden",height:"0"},"#upscope___request-agent-button.upscope___request-agent-button--visible":{display:"block"},"#upscope___request-agent-button:hover":{opacity:"1","box-shadow":"0 3px 15px 0 rgba(0,0,0,0.50)"},"#upscope___request-agent-button.upscope___request-agent-button--pending":{"background-image":"url(\"data:image/svg+xml,%3Csvg width='19' height='25' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M16.856 24.393a.825.825 0 0 1-.477.514c-.23.096-.46.118-.686.065-3.568-.82-6.675-2.472-9.321-4.954a20.246 20.246 0 0 1-5.456-8.701C-.16 7.858-.288 4.35.536.795A1.1 1.1 0 0 1 .894.21a.829.829 0 0 1 .673-.202H6.22c.24-.004.46.077.66.242.2.165.317.37.35.615l.94 5.21a.938.938 0 0 1-.1.624 1.296 1.296 0 0 1-.472.493L4.57 8.68a15.243 15.243 0 0 0 2.076 5.138 15.98 15.98 0 0 0 3.707 4.085l2.67-2.061c.208-.13.426-.2.651-.207a.946.946 0 0 1 .606.184l4.286 3.127c.207.137.341.331.402.583a.978.978 0 0 1-.072.697l-2.039 4.168z' fill='%23d0d0d0' fill-rule='evenodd' fill-opacity='.95'/%3E%3C/svg%3E\"), linear-gradient(0deg, #F8F8F8 0%, #FFFFFF 98%)",opacity:"0.85",cursor:"default"},"#upscope___request-agent-button__close":{position:"absolute",top:"8px",right:"8px",height:"14px",width:"14px",opacity:"0.6"},"#upscope___request-agent-button__close::before,#upscope___request-agent-button__close::after":{content:"''",width:"2px",background:"#535353",position:"absolute",left:"6px",height:"10px",top:"2px","-webkit-transform":"rotate(45deg)",transform:"rotate(45deg)"},"#upscope___request-agent-button__close::after":{"-webkit-transform":"rotate(-45deg)",transform:"rotate(-45deg)"},"#upscope___request-agent-button__close:hover":{opacity:"1"},".upscope___request-agent-button--pending #upscope___request-agent-button__close":{display:"none"}};s.default=class{constructor(e){this._pageMatches()?(this.visible=!1,this.requesting=!1,this._injectElements(),setInterval(this._injectElements.bind(this),1e3),this.connection=e,"always"===y("showAgentRequestButton")?this.activate():e.listen("agentsAvailable",this.activate.bind(this)),e.listen("sessionStart","sessionContinue",this.deactivate.bind(this)).listen("sessionEnd",this.activate.bind(this)).listen("agentRequestUpdate",this.onStatusChange.bind(this))):a("Not showing agent request button as the page does not match")}activate(){a("Activating agent request button"),this._injectElements(),this.visible=!0,this.requesting=!1,this._toggleClass()}deactivate(){a("Deactivating agent request button"),this._injectElements(),this.visible=!1,this.requesting&&this.connection.cancelRequestAgent(),this._toggleClass()}onCloseButtonClick(e){e.stopPropagation(),this.deactivate()}_toggleClass(){var e=(this.requesting?"upscope___request-agent-button--pending":"")+(this.visible?" upscope___request-agent-button--visible":"");this.buttonElement.className!==e&&(this.buttonElement.className=e)}_pageMatches(){for(const e of y("agentRequestButtonPages"))if((0,t.matchesPattern)(e,b().href))return!0;return!1}onStatusChange(e){switch(this.requesting="pending"===e,this._toggleClass(),e){case"accepted":(0,o.alert)(y("agentRequestResultTitle"),y("agentRequestAcceptedText")),this.deactivate();break;case"unavailable":null===y("unavailableAgentRequestRedirectTo")?(0,o.alert)(y("agentRequestResultTitle"),y("agentRequestNotAvailableText")):y("unavailableAgentRequestRedirectImmediately")?location.href=y("unavailableAgentRequestRedirectTo"):(0,o.alert)(y("agentRequestResultTitle"),y("agentRequestNotAvailableText")).then(()=>{location.href=y("unavailableAgentRequestRedirectTo")})}}onButtonClick(){this.requesting?this.connection.cancelRequestAgent():this.connection.requestAgent()}_injectElements(){if(!this.buttonElement||!document.querySelector("#upscope___request-agent-button-container")){a("Adding agent request button element");const e=document.createElement("div"),t=document.createElement("span"),o=document.createElement("span"),n=document.createElement("span"),s=document.createElement("span"),i=document.createElement("span"),r=(0,c.default)(document,l,{id:"upscope___request-agent-button-container"});e.id="upscope___request-agent-button",e.style.cssText=y("agentRequestButtonStyle"),e.addEventListener("click",this.onButtonClick.bind(this)),t.id="upscope___request-agent-button__close",t.addEventListener("click",this.onCloseButtonClick.bind(this)),o.textContent=y("agentRequestButtonTitle"),o.id="upscope___request-agent-button__title",n.textContent=y("agentRequestButtonSubtitle"),n.id="upscope___request-agent-button__subtitle",s.textContent=y("agentRequestButtonRequestingTitle"),s.id="upscope___request-agent-button__requesting-title",i.textContent=y("agentRequestButtonRequestingSubtitle"),i.id="upscope___request-agent-button__requesting-subtitle",e.append(t),e.append(o),e.append(n),e.append(s),e.append(i),r.append(e),this.buttonElement=e}this._toggleClass()}}}.call(this,u("upscope:modules/request-agent-button-controller.js"))},{"../utils.js":55,"./dialogs.js":26,"./internal-elements-css.js":47}],52:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;const s=["region","shortId","lastConnectedAt","waitingForCallAt","lookupCodeSetAt","lookupCode"];function i(e){try{var t=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return t?atob(t[2]):null}catch(e){return null}}function r(e,t,o){try{t=t&&btoa(t);const n=new Date;n.setMonth(n.getMonth()+1),document.cookie=e+`=${t};domain=.${o};path=/;expires=`+n.toGMTString()}catch(e){}}o.default={async get(e){if(y("storageImplementation"))return y("storageImplementation").getItem(e);let t=localStorage.getItem("__upscope:"+e)||i("_upscope__"+e)||null;if(null===t)return null;try{t=JSON.parse(t)}catch(e){}return this.set(e,t),t},async set(t,o){if(!s.includes(t))throw new Error("Storage key not allowed");if(y("storageImplementation"))return y("storageImplementation").setItem(t,o);o=JSON.stringify(o),localStorage.setItem("__upscope:"+t,o);const n=location.hostname.split(".");for(let e=n.length-2;0<=e&&(r("_upscope__"+t,o,n.slice(e).join(".")),i("_upscope__"+t)!==o);e--);},async del(t){if(y("storageImplementation"))return y("storageImplementation").removeItem(t);localStorage.removeItem("__upscope:"+t);const o=location.hostname.split(".");for(let e=o.length-2;0<=e&&(n="_upscope__"+t,s=o.slice(e).join("."),r(n,"",s,new Date(0)),null!==i("_upscope__"+t));e--);var n,s},async clear(){await Promise.all(s.map(e=>this.del(e)))}}},{}],53:[function(t,e,o){!function(c){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var e,l=(e=t("./internal-elements-css.js"))&&e.__esModule?e:{default:e};const u={"#upscope___promo-link, #upscope___promo-link *":{"text-decoration":"none","font-size":"12px","font-family":"'Avenir Next', Avenir, 'Lucida Grande', Helvetica, sans-serif","text-transform":"uppercase","letter-spacing":"0.4px","-webkit-font-smoothing":"subpixel-antialiased","font-weight":"600","user-select":"none"},"#upscope___promo-link":{"z-index":"2147483647",display:"none","border-radius":"0 3px 0 0",padding:"2px 2px 2px 5px",position:"fixed",bottom:"0",left:"0",background:"rgba(255, 255, 255, 0.8)",color:"#515151",border:"1px solid rgba(0, 0, 0, 0.5)","border-left":"none","border-bottom":"none"},"#upscope___promo-link.upscope___promo-link--active, #upscope___promo-link.upscope___promo-link--deactivating":{display:"block"},"#upscope___promo-link__upscope-link":{position:"relative",cursor:"pointer",color:"black"},"#upscope___promo-link__icon":{"font-weight":"700"},"#upscope___promo-link__stop-button":{background:"#d90000",color:"white","border-radius":"2px",padding:"0 3px",cursor:"pointer","text-shadow":"0.3px 0 0 white"},"#upscope___promo-link__upscope-link + #upscope___promo-link__stop-button":{"margin-left":"10px"},"#upscope___promo-link__stop-button:hover":{background:"#a30000"},"#upscope___promo-link__stop-button:active":{background:"#770000"},"#upscope___promo-link.upscope___promo-link--deactivating #upscope___promo-link__stop-button":{display:"none"},"#upscope___promo-link.upscope___promo-link--deactivating #upscope___promo-link__screensharing-by":{display:"none"},"#upscope___promo-link__thank-you, #upscope___promo-link__learn-more":{display:"none"},"#upscope___promo-link.upscope___promo-link--deactivating #upscope___promo-link__thank-you, #upscope___promo-link.upscope___promo-link--deactivating #upscope___promo-link__learn-more":{display:"inline"}};o.default=class{constructor(e){(y("showUpscopeLink")||y("showTerminateButton"))&&(this._injectElements(),setInterval(this._injectElements.bind(this),1e3),this.connection=e,this.active=!1,e.listen("sessionStart","sessionContinue",this.activate.bind(this)).listen("sessionEnd",this.deactivate.bind(this)))}activate(){c("Activating info button"),this._injectElements(),this.active=!0,this.innerContainer.className="upscope___promo-link--active",clearTimeout(this.deactivationTimeout)}deactivate(){c("Deactivating info button"),this._injectElements(),this.active=!1,y("showUpscopeLink")?(this.innerContainer.className="upscope___promo-link--deactivating",this.deactivationTimeout=setTimeout(()=>{this.innerContainer.className=""},3e4)):this.innerContainer.className=""}_injectElements(){if(!this.innerContainer||!document.querySelector("#upscope___promo-link-container")){c("Adding info button element");const e=(0,l.default)(document,u,{id:"upscope___promo-link-container"}),t=document.createElement("div");if(t.id="upscope___promo-link",y("showUpscopeLink")){const o=document.createElement("a"),n=(o.id="upscope___promo-link__upscope-link",o.href="https://helloscreen.com/hello?utm_source=upscope&utm_campaign=promo-link&utm_audience="+b().hostname,o.target="_blank",o.rel="noopener",document.createElement("span")),s=(n.id="upscope___promo-link__screensharing-by",n.textContent="Screensharing by ",document.createElement("span")),i=(s.id="upscope___promo-link__thank-you",s.textContent="Thank you for using ",document.createElement("span")),r=(i.id="upscope___promo-link__icon",i.textContent="Upscope",document.createElement("span"));r.id="upscope___promo-link__learn-more",r.textContent=". Click to learn more.",o.append(n),o.append(s),o.append(i),o.append(r),t.append(o)}if(y("showTerminateButton")){const a=document.createElement("a");a.id="upscope___promo-link__stop-button",a.href="#",a.__upscopeDialogButton=!0,a.textContent=y("translationsStopSession"),a.addEventListener("click",e=>{e.preventDefault(),this.connection.stopSession()}),t.append(a)}this.innerContainer=t,this.active&&(this.innerContainer.className="upscope___promo-link--active"),e.append(t)}}}}.call(this,u("upscope:modules/terminate-button-controller.js"))},{"./internal-elements-css.js":47}],54:[function(h,e,t){!function(a){"use strict";var c=h("./utils.js"),l=(e=h("./default-configuration.js"))&&e.__esModule?e:{default:e};const u="1.17.14";{var d=window,p=window.Upscope;if(void 0===p)console.error("The Upscope javascript snippet was not installed correctly.");else if(void 0!==d.Upscope._config)console.warn("The Upscope javascript code was loaded twice.");else{if("extension"!==d.__upscopeContext__&&"string"==typeof localStorage.getItem("upscopeTestingKey")){var[e,t]=localStorage.getItem("upscopeTestingKey").split(":");if(t!==d.Upscope.__defaultConfiguration.apiKey){delete d.Upscope.__defaultConfiguration,delete d.Upscope.__defaultRegion;const n=document.createElement("script"),s=(n.type="text/javascript",n.async=!0,"development"===e?n.src="http://localhost:3005/code/"+t+".js":"staging"===e&&(n.src="https://code.upscope.xyz/"+t+".js"),document.querySelectorAll("script")[0]);return void(s.parentNode.insertBefore(n,s),console.warn("The Upscope code is now in testing replacement mode"))}}if(void 0!==d.Prototype&&d.Array&&d.Array.prototype&&void 0!==d.Array.prototype.toJSON)console.error("This page uses a version of Prototype.js that will break JSON (and Upscope). See here: https://help.upscope.io/en/articles/1476027-upscope-compatibility-with-prototype");else{let e=!1;try{d.parent!==d&&void 0!==d.parent.Upscope&&(e=!0)}catch(e){a("No access to parent window.")}if(e)"extension"!==d.__upscopeContext__&&console.warn("Upscope is already loaded in the parent window, terminating.");else{d.Upscope._version=u;const i=p.q.push;async function o(){var[e,t]=p.q.shift(),t=t||{};if("init"!==e)return console.error('The first command must be "init"');const o={...l.default};if(d.Upscope.__defaultConfiguration){Object.assign(o,d.Upscope.__defaultConfiguration);const i=Object.keys(d.Upscope.__defaultConfiguration),r=Object.keys(t);i.some(e=>r.includes(e))&&(o.jsConfiguration=!0)}else o.jsConfiguration=!0;if(Object.assign(o,t),a("PAGELOAD - Initiating Upscope version %s",u),location.href&&a("Current page is: %s",location.href),document.referrer&&a("Previous page was: %s",document.referrer),!o.apiKey)return console.error("API key required");null!==o.uniqueId&&void 0!==o.uniqueId&&["USER UNIQUE ID","undefined","null"].includes(o.uniqueId)&&delete o.uniqueId,null!==o.identities&&void 0!==o.identities&&["list of identities here","undefined","null"].includes("function"==typeof o.identities.join?o.identities.join(" "):o.identities)&&delete o.identities,null!==o.tags&&void 0!==o.tags&&"#list #of #tags #here"===("function"==typeof o.tags.join?o.tags.join(" "):o.tags)&&delete o.tags,null!==o.integrationIds&&void 0!==o.integrationIds&&"integration_name:resource_id"===("string"==typeof o.integrationIds?o.integrationIds:o.integrationIds.join(" "))&&delete o.integrationIds,o.version=u,d.Upscope._config=o,await(0,c.until)(()=>Boolean(document.body));const n=h("./modules/frame-handler.js").default;if(await(new n).isChild())return k("info","attached to parent iframe");const s=h("./modules/connection.js").default;new s}0<p.q.length?o():p.q.push=function(){(p.q.push=i).apply(p.q,arguments),o()},setTimeout(()=>{void 0===d.Upscope._config&&"extension"!==d.__upscopeContext__&&console.warn('Please remember to call Upscope("init"); for Upscope to work!')},1e4)}}}}}.call(this,u("upscope:upscope.js"))},{"./default-configuration.js":1,"./modules/connection.js":24,"./modules/frame-handler.js":28,"./utils.js":55}],55:[function(e,t,o){"use strict";function n(){return!0}function s(){return!1}function i(){return!1}Object.defineProperty(o,"__esModule",{value:!0}),o.attempt=function(e,t=void 0){try{return e()}catch(e){return t}},o.baseEndpoint=function(e,t,o="http"){return o+`s://${e}.upscope.io`},o.intercept=function(e,t,o){e["__original__"+t]=e[t],e[t]=o;for(const n in e["__original__"+t])e[t][n]=e["__original__"+t][n]},o.isOnprem=i,o.isProduction=n,o.isStaging=s,o.matchesPattern=function(e,t){return e=(e=(e=e.replace(/[\\^$.+?()[\]{}|]/g,"\\$&")).startsWith("*")?e.replace(/^\*+/,""):"^"+e).endsWith("*")?e.replace(/\*+$/,""):e+"$",new RegExp(e.replace(/\*/g,".*")).test(t)},o.once=function(t){let o=!1;return(...e)=>{o||t(...e),o=!0}},o.parseUrl=function(e){return(r=r||document.createElement("a")).href=e,{host:r.host,hostname:r.hostname,protocol:r.protocol,port:r.port,pathname:r.pathname,origin:r.origin,search:r.search}},o.randomString=function(t,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"){let n="";for(let e=0;e<t;e++){var s=Math.floor(Math.random()*o.length);n+=o.slice(s,s+1)}return n},o.sleep=function(t){return new Promise(e=>{setTimeout(e,t)})},o.throttle=function(t,o){let n=!1,s=null;return(...e)=>{n?(clearTimeout(s),s=setTimeout(()=>{t.apply(this,e)},o)):(clearTimeout(s),t.apply(this,e),n=!0,setTimeout(()=>{n=!1},o))}},o.timeout=function(e,o){return Promise.race([e,new Promise((e,t)=>{setTimeout(()=>t(new Error("Did not complete in "+o+"ms")),o)})])},o.until=function(n,s=50){return new Promise((e,t)=>{const o=async()=>{try{if(!await n())return setTimeout(o,s);e()}catch(e){return t(e)}};o()})},o.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0,o="x"===e?t:3&t|8;return o.toString(16)})};let r},{}]},{},[54])}(void 0);